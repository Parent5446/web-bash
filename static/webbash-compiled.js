function h(a){return function(){return a}}
(function(a){a.Event.prototype.r=function(){var a={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},c={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},d=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(d))return!1;"undefined"!==typeof c[d]&&(d=c[d]);c=String.fromCharCode(d);
this.shiftKey?"undefined"!==typeof a[c]&&(c=a[c]):c=c.toLowerCase();return c}})(jQuery);window.Terminal=function(){this.h=null;this.prompt="root@ubuntu> ";this.c=[];this.d=0;this.n=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'))};this.i=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.n()};this.q=function(a){var b=$('<div class="system_output"></div>');b.text(a);$("body > ul > li:last-child").append(b);
this.n()};this.blink=function(){$("#cursor").toggleClass("blink")};this.l=function(){var a=$("#cursor"),b,c,d=a.prev(),g=a.next();if(0===d.length||!d.hasClass("userinput"))return!1;var e=d.text();if(0===e.length)return!1;b=e.substr(e.length-1);c=a.text();0===g.length&&"&nbsp;"!==c&&(g=$('<div class="userinput"></div>'),a.after(g));d.text(e.substring(0,e.length-1));a.text(b);return"&nbsp;"!==c?(g.prepend(c),!0):!1};this.g=function(){var a=$("#cursor"),b,c,d,g=a.prev(),e=a.next();if(0===e.length||!e.hasClass("userinput"))return!1;
d=e.text();if(0===d.length)return!1;b=d[0];c=a.text();if(0===e.length)return a.html("&nbsp;"),!1;e.text(d.substr(1));a.text(b);g.append(c);return!0};this.k=function(a){var b=$("#cursor").parent().children(".userinput").text();this.c[this.d]=b.substr(0,b.length-1);a=this.d+a;a<this.c.length&&0<=a&&(this.d=a,a=$("#cursor"),a.next().text(""),a.html("&nbsp;"),a.prev().text(this.c[this.d]))};this.t=function(a){var b;if(37===a.which)this.l();else if(39===a.which)this.g();else if(38===a.which)this.k(-1);
else if(40===a.which)this.k(1);else if(35===a.which)for(;this.g(););else if(36===a.which)for(;this.l(););else if(!a.ctrlKey||a.metaKey||a.shiftKey||67!==a.which)if(46===a.which)if(b=$("#cursor"),a=b.next(),0!==a.length&&a.hasClass("userinput")){var c=a.text();0!==c.length?(b.text(c.substr(0,1)),a.text(c.substr(1))):b.html("&nbsp;")}else b.html("&nbsp;");else 8===a.which?(a.preventDefault(),b=$("#cursor").prev(),0<b.length&&b.hasClass("userinput")&&b.text(b.text().slice(0,-1))):13===a.which?(b=$("#cursor").parent().children(".userinput").text(),
b=b.substr(0,b.length-1),0<b.length&&(this.c[this.c.length]=b,this.d=this.c.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.h.execute($.trim(b),this).progress($.proxy(this.q,this)).always($.proxy(this.i,this))):222===a.which&&a.shiftKey?(a.preventDefault(),b=$("#cursor").prev(),b.append('"'),this.g()):222===a.which?(a.preventDefault(),b=$("#cursor").prev(),b.append("'"),this.g()):(b=$("#cursor").prev(),(a=a.r())&&b.append(a));else a.preventDefault(),
$("#cursor").next().append("^C"),this.i();$(window).scrollTop($(document).height())};this.bind=function(a){this.h=a;this.h.o(this);this.i()};$(window.document).keydown($.proxy(this.t,this));window.setInterval(this.blink,500)};function l(){this.a={"?":"0"};this.v=/[\w\?\-\!]+/i;this.o=function(a){a.prompt="root@ubuntu> "};this.execute=function(a,b){var c=$.Deferred(),d=this.u(this.splitText(a));setTimeout($.proxy(function(){this.f(d,b,c)},this),0);return c.promise()};this.f=function(a,b,c){b=a[0];this.a.w=a[a.length-1];if("eval"===a[0])a.shift(),0<a.length?this.f(a,output):this.a["?"]="0";else if("help"===a[0])c.notify(["Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. "]),
c.notify(["To see a full list of commands, type 'commands' "]),this.a["?"]="0";else if("echo"===a[0])a.shift(),c.notify([a.join(" ")]),this.a["?"]="0";else if("export"===a[0]){for(b=1;b<a.length;++b){var d=a[b].split("=",2);this.a[d[0]]=d[1]}this.a["?"]="0"}else if("unset"===a[0]){for(b=1;b<a.length;++b)this.a[a[b]]="";this.a["?"]="0"}else"undefined"!==typeof l.commands[a[0]]?(d=[new p,new p,new p],d[1].flush=function(a){c.notify([a])},d[2].flush=function(a){c.notify([a])},this.a["?"]=l.commands[b](d,
a.length,a,this.a).toString()):void 0!==a[0]&&""!==a[0]&&(c.notify(["error: unknown command "+a[0]]),this.a["?"]="127");c.resolve()};this.u=function(a){for(var b=1;b<a.length;++b)for(var c=a[b].indexOf("$");0<=c;c=a[b].indexOf("$",c+1))if(0!==c&&"\\"===a[b][c-1])a[b]=a[b].substr(0,c-1)+a[b].substr(c);else{var d=this.v.exec(a[b].substr(c+1))[0];null!==d&&("undefined"===typeof this.a[d]&&(this.a[d]=""),a[b]=a[b].substr(0,c)+this.a[d]+a[b].substr(c+d.length+1))}return a};this.splitText=function(a){for(var b=
"",c=[],d=!1,g=!1,e=!1,f=0;f<a.length;f++)" "===a[f]&&(d||g)?b+=a[f]:" "!==a[f]||d||g?"\\"===a[f]?e||d?(b+="\\",e=!1):e=!0:"'"===a[f]?e?(b+="'",e=!1):g?b+="'":d=!d:'"'===a[f]?e?(b+='"',e=!1):d?b+='"':g=!g:"$"===a[f]&&d?b+="\\$":(b+=a[f],e=!1):0<b.length&&(c.push(b),b="");b=$.trim(b);""!==b&&c.push(b);return c}}l.commands={};window.WebBash=l;window.WebBashLogin=function(){this.p=new q;this.b="";this.o=function(a){a.prompt="Username: "};this.execute=function(a,b){var c=$.Deferred();setTimeout($.proxy(function(){this.f(a,b,c)},this),0);return c.promise()};this.f=function(a,b,c){""===this.b?(this.b=a,""!==a&&(b.prompt="Password: "),c.resolve()):this.p.s(this.b,a).done(function(){b.bind(new l)}).fail(function(a){c.notify(a.responseText);this.b=null;b.prompt="Username: ";c.resolve()})}};function p(){this.e=0;this.buffer="";this.write=function(a){this.buffer+=a;this.flush(this.buffer)};this.B=function(a){if(this.e>=this.buffer.length)return!1;if(void 0===a)return this.e=this.buffer.length,this.A;var b=this.buffer.substr(this.e,a);this.e+=a;return b};this.flush=function(){}};function q(){this.m=this.b="";this.s=function(a,b){this.b=a;this.m=b;return this.j("GET","/login").then($.proxy(function(a){return this.j("POST","/login",{username:this.b,password:this.m,token:a.token})},this))};this.j=function(a,b,c,d){return $.ajax({async:void 0===d?!0:d,data:c,dataType:"json",type:a,url:"api.php"+b})}};(function(a,b){b.commands["false"]=h(1);b.commands["true"]=h(0);b.commands.commands=function(a){var d=[],g;for(g in b.commands)b.commands.hasOwnProperty(g)&&d.push(g);a[1].write(d.join("<br/>"));return 0};b.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var g=new Date,e=Array(7);e[0]="Sun";e[1]="Mon";e[2]="Tue";e[3]="Wed";e[4]="Thu";e[5]="Fri";e[6]="Sat";var f=Array(12);f[0]="Jan";f[1]="Feb";f[2]="Mar";f[3]="Apr";f[4]="May";f[5]="Jun";f[6]="Jul";f[7]="Aug";f[8]=
"Sep";f[9]="Oct";f[10]="Nov";f[11]="Dec";var n="UTC";4===g.getTimezoneOffset()/60&&(n="EDT");var e=e[g.getDay()].toString()+" "+f[g.getMonth()].toString()+" "+g.getDate().toString()+" ",k=g.getHours(),f=k.toString();10>k&&(f="0"+k.toString());var m=g.getMinutes(),k=m.toString();10>m&&(k="0"+m.toString());var m=g.getSeconds(),r=m.toString();10>m&&(r="0"+m.toString());e+=f+":"+k+":"+r+" "+n+" "+g.getFullYear().toString()+" ";a[1].write(e);return 0}})(jQuery,l);(function(a,b){var c=new q;b.commands.ls=function(a,b,e){1===b&&(e[b]="~",b++);for(var f=1;f<b;f++)for(var n=c.j("GET","/files"+e[1],{},!1),k=0;k<n.responseJSON.length;k++)a[1].write(n.responseJSON[k]+"\n");return 0};b.commands.ln=h(0);b.commands.touch=h(0);b.commands.mkdir=h(0);b.commands.cp=h(0);b.commands.mv=h(0);b.commands.rm=h(0);b.commands.chmod=h(0);b.commands.chgrp=h(0);b.commands.chown=h(0)})(jQuery,l);
