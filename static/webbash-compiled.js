function r(a,b,g){var c=a[0];"~"===c?a=g+"/"+a:"/"!==c&&(a=b+"/"+a);a=a.substr(1).split("/");b=[];for(g=0;g<a.length;g++)"."!==a[g]&&""!==a[g]&&(".."===a[g]?b.pop():b.push(a[g]));return"/"+b.join("/")};function v(a,b,g,c){"undefined"===typeof b&&(b=0);"undefined"===typeof g&&(g=" ");"undefined"===typeof c&&(c="left");if(""===g)return a;if(b+1>=a.length)switch(c){case "left":a=Array(b+1-a.length).join(g)+a;break;case "both":b=b-a.length;c=Math.ceil(b/2);a=Array(b-c+1).join(g)+a+Array(c+1).join(g);break;default:a=a+Array(b+1-a.length).join(g)}return a};$.b=function(a,b){for(var g={},c=[a[0]],f=1;f<a.length;f++){if("-"!==a[f][0])if("+"===b[0]){c=$.merge(c,a.slice(f));break}else{c.push(a[f]);continue}else if("--"===a[f]){c=$.merge(c,a.slice(f));break}for(var m=1;m<a[f].length;m++){var e=a[f][m],d=b.indexOf(e);if(-1===d)return["Unknown option -"+e,a];if(":"===b[d+1])if(m===a[f].length-1&&"-"!==a[f+1][0])g[e]=a[++f];else if(":"!==b[d+2])if(m+1<a[f].length){g[e]=a[f].substr(m+1);break}else return["Option -"+e+" requires an argument",a];else g[e]=!0;
else g[e]=!0}}return[g,c]};function w(a){for(var b="",g=[],c=!1,f=!1,m=!1,e=0;e<a.length;e++)" "===a[e]&&(c||f)?b+=a[e]:" "!==a[e]||c||f?"\\"===a[e]?m||c?(b+="\\",m=!1):m=!0:"'"===a[e]?m?(b+="'",m=!1):f?b+="'":c=!c:'"'===a[e]?m?(b+='"',m=!1):c?b+='"':f=!f:"$"===a[e]&&c?b+="\\$":(b+=a[e],m=!1):0<b.length&&(g.push(b),b="");b=$.trim(b);""!==b&&g.push(b);return g};window.Terminal=function(){this.j=null;this.c="root@ubuntu> ";this.b=[];this.h=0;this.promise=null;this.l=!1;this.B=/\n/g;this.m=function(){(this.l=!this.l)?($("#cursor").before($('<div id="hiddentext" class="userinput"></div>')),$("#cursor").after($('<div id="hiddentext" class="userinput"></div>'))):($("#cursor").before($('<div class="userinput"></div>')),$("#cursor").after($('<div class="userinput></div>')))};this.u=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));
this.l?($("#cursor").before($('<div id="hiddentext" class="userinput"></div>')),$("#cursor").after($('<div id="hiddentext" class="userinput"></div>'))):($("#cursor").before($('<div class="userinput"></div>')),$("#cursor").after($('<div class="userinput></div>')));$(window).scrollTop($(document).height())};this.A=function(){$("body > ul").empty()};this.o=function(){this.promise=null;this.l=!1;$("body > ul").append("<li>"+this.c+"</li>");this.u()};this.C=function(a){var b=$('<div class="system_output"></div>');
b.text(a);b.html(b.html().replace(this.B,"<br>"));$("body > ul > li:last-child").append(b);this.u()};this.w=function(){$("#cursor").toggleClass("blink")};this.t=function(){var a=$("#cursor"),b,g,c=a.prev(),f=a.next();if(0===c.length||!c.hasClass("userinput"))return!1;var m=c.text();if(0===m.length)return!1;b=m.substr(m.length-1);g=a.text();0===f.length&&"&nbsp;"!==g&&(f=$('<div class="userinput"></div>'),a.after(f));c.text(m.substring(0,m.length-1));a.text(b);return"&nbsp;"!==g?(f.prepend(g),!0):
!1};this.q=function(){var a=$("#cursor"),b,g,c,f=a.prev(),m=a.next();if(0===m.length||!m.hasClass("userinput"))return!1;c=m.text();if(0===c.length)return!1;b=c[0];g=a.text();if(0===m.length)return a.html("&nbsp;"),!1;m.text(c.substr(1));a.text(b);f.append(g);return!0};this.s=function(a){var b=$("#cursor").parent().children(".userinput").text();this.b[this.h]=b.substr(0,b.length-1);a=this.h+a;a<this.b.length&&0<=a&&(this.h=a,a=$("#cursor"),a.next().text(""),a.html("&nbsp;"),a.prev().text(this.b[this.h]))};
this.D=function(a){var b;if(37===a.which)a.preventDefault(),this.t();else if(39===a.which)a.preventDefault(),this.q();else if(38===a.which)a.preventDefault(),this.s(-1);else if(40===a.which)a.preventDefault(),this.s(1);else if(35===a.which)for(;this.q(););else if(36===a.which)for(;this.t(););else if(a.ctrlKey&&!a.metaKey&&!a.shiftKey&&67===a.which)a.preventDefault(),$("#cursor").next().append("^C"),this.o();else if(a.ctrlKey&&!a.metaKey&&!a.shiftKey&&68===a.which)a.preventDefault(),this.promise&&
this.promise.k?($("#cursor").next().append("^D"),this.promise.k.close()):(this.j.b(this),this.j.i.b(),window.open("","_self",""),window.close(),self.close());else if(46===a.which)if(b=$("#cursor"),a=b.next(),0!==a.length&&a.hasClass("userinput")){var g=a.text();0!==g.length?(b.text(g.substr(0,1)),a.text(g.substr(1))):b.html("&nbsp;")}else b.html("&nbsp;");else if(8===a.which)a.preventDefault(),b=$("#cursor").prev(),0<b.length&&b.hasClass("userinput")&&b.text(b.text().slice(0,-1));else if(13===a.which)b=
$("#cursor").parent().children(".userinput").not(".completed"),a=b.text(),a=$.trim(a.substr(0,a.length-1)),b.addClass("completed"),0!=$("#cursor").next().length?($("#cursor").prev().append($("#cursor").text()),$("#cursor").next().append("<br>")):$("#cursor").prev().append($("#cursor").text()+"<br>"),this.promise&&this.promise.k?this.promise.k.write(a):0<a.length?(this.b[this.b.length]=a,this.h=this.b.length,this.promise=this.j.h($.trim(a),this),this.promise.progress($.proxy(this.C,this)).always($.proxy(this.o,
this))):this.o();else if(222===a.which&&a.shiftKey)a.preventDefault(),b=$("#cursor").prev(),b.append('"'),this.q();else if(222===a.which)a.preventDefault(),b=$("#cursor").prev(),b.append("'"),this.q();else if(!a.ctrlKey&&!a.metaKey){b=$("#cursor").prev();a.preventDefault();var g={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},c={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,
107:43,109:45,110:46,111:47,173:45,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},f=a.which;0<=[16,37,38,39,40,20,17,18,91].indexOf(f)?a=!1:("undefined"!==typeof c[f]&&(f=c[f]),c=String.fromCharCode(f),a.shiftKey?"undefined"!==typeof g[c]&&(c=g[c]):c=c.toLowerCase(),a=c);a&&b.append(a)}$(window).scrollTop($(document).height())};this.bind=function(a){null!==this.j&&this.j.b.call(this.j,this);this.j=a;this.j.m.call(this.j,this);this.o()};$(window.document).keydown($.proxy(this.D,
this));$(window).bind("beforeunload",function(){this.j.b.call(this.j,this)});window.setInterval(this.w,500);window.setInterval($.proxy(function(){this.j.b(this)},this),1E4)};function x(a){this.e={"?":"0"};this.l={};this.o=/[\w\?\-\!]+/i;this.f=a;this.c=0;this.i=new y;this.m=function(b){var a=this.i.a("GET","/users/"+this.f,{},{},!1),c=this.i.a("GET","/users/"+this.f+"/history",{},{},!1);(a=a.responseJSON.homedir)||(a="/");this.e.USER=this.f;this.e.HOME=a;this.e.PWD=a;b.c=this.f+"@ubuntu "+a+" $ ";200===c.status&&(b.b=c.responseJSON,this.c=b.h=c.responseJSON.length)};this.b=function(b){this.c<b.b.length&&(this.i.a("PATCH","/users/"+this.f+"/history",{history:b.b.slice(this.c)}),
this.c=b.b.length)};this.h=function(b,a){var c=$.Deferred();c.k=new z;setTimeout($.proxy(function(){var f=b;"string"===typeof f&&(f=this.F(w(b)));this.r(f,a,c)},this),0);var f=c.promise();f.k=c.k;return f};this.r=function(b,a,c){b[0]in this.l&&(b=$.merge(w(this.l[b[0]]),b.slice(1)));var f="0",m=[c.k,new z,new z],e=!1;foundStderr=!1;nextCmd=null;pipeIndex=b.indexOf("|");if(-1!==pipeIndex){var e=!0,d=b.splice(pipeIndex,b.length-pipeIndex);d.shift();0<d.length&&(nextCmd=this.h(d,a),m[1].n().progress(function(f){nextCmd.k.write(f.p())}),
m[1].n().done(function(f){nextCmd.k.write(f.p());nextCmd.k.close()}),nextCmd.progress(function(f){c.notify(f)}))}for(d=b.indexOf(">");-1!==d;d=b.indexOf(">",d+1)){var e=!0,l=r(b[d+1],this.e.PWD,this.e.HOME);m[1].n().done($.proxy(function(f){var a=f.p();this.i.a("POST","/files"+l,"",{}).done($.proxy(function(){this.i.a("PATCH","/files"+l,a,{"Content-Type":"text/plain"})},this))},this));b.splice(d,2)}for(d=b.indexOf("2>");-1!==d;d=b.indexOf("2>",d+1))foundStderr=!0,l=r(b[d+1],this.e.PWD,this.e.HOME),
m[2].n().done($.proxy(function(f){var a=f.p();this.i.a("POST","/files"+l,"",{}).done($.proxy(function(){this.i.a("PATCH","/files"+l,a,{"Content-Type":"text/plain"})},this))},this)),b.splice(d,2);for(d=b.indexOf("<");-1!==d;d=b.indexOf("<",d+1))l=r(b[d+1],this.e.PWD,this.e.HOME),m[0]=new z,this.i.a("GET","/files"+l).done(function(f){m[0].write(f);m[0].close()}),b.splice(d,2);e||(m[1].write=function(f){c.notify([f])});foundStderr||(m[2].write=function(f){c.notify([f])});if("exit"===b[0])this.b(a),this.i.b(),
window.open("","_self",""),window.close(),self.close();else if("clear"===b[0])a.A();else if("alias"===b[0]){for(d=1;d<b.length;++d)e=b[d].split("=",2),2==e.length&&(this.l[e[0]]=e[1]);f="0"}else b[0]in x.commands?f=x.commands[b[0]](m,b.length,b,this.e,a):b[0]&&(c.notify(["error: unknown command "+b[0]]),f="127");var k=$.proxy(function(f){this.e["?"]=f.toString();a.c=this.f+"@ubuntu "+this.e.PWD+" $ ";c.resolve(f)},this);"object"===$.type(f)&&void 0!==f.then?(f.then(function(){m[0].close();m[1].close();
m[2].close()}),null===nextCmd?f.then(k):f.then(function(){nextCmd.then(k)})):(m[0].close(),m[1].close(),m[2].close(),null===nextCmd?k(f):nextCmd.then(function(){k(f)}))};this.F=function(a){for(var g=1;g<a.length;++g)for(var c=a[g].indexOf("$");0<=c;c=a[g].indexOf("$",c+1))if(0!==c&&"\\"===a[g][c-1])a[g]=a[g].substr(0,c-1)+a[g].substr(c);else{var f=this.o.exec(a[g].substr(c+1))[0];null!==f&&("undefined"===typeof this.e[f]&&(this.e[f]=""),a[g]=a[g].substr(0,c)+this.e[f]+a[g].substr(c+f.length+1))}return a}}
x.commands={};window.WebBash=x;window.WebBashLogin=function(){this.i=new y;this.f="";this.m=function(a){a.c="Username: "};this.b=function(){};this.h=function(a,b){var g=$.Deferred();setTimeout($.proxy(function(){this.r(a,b,g)},this),0);return g.promise()};this.r=function(a,b,g){""===this.f?(this.f=a,""!==a&&(b.c="Password: "),g.resolve(),""!==a&&b.m()):this.i.c(this.f,a).done($.proxy(function(){b.m();b.bind(new x(this.f))},this)).fail($.proxy(function(a){g.notify("\n"+a.responseText);this.f="";b.c="Username: ";b.m();g.resolve()},
this))}};function z(){this.h=0;this.b="";this.c=$.Deferred();this.write=function(a){this.b+=a;null!==this.c&&this.c.notify(this)};this.p=function(){var a="";this.h>=this.b.length?a="":(a=this.b.substr(this.h),this.h=this.b.length);return a};this.n=function(){return this.c.promise()};this.close=function(){this.c.resolve(this)}};function y(){this.v=this.f="";this.c=function(a,b){this.f=a;this.v=b;return this.a("GET","/login").then($.proxy(function(a){return this.a("PUT","/login",{username:this.f,password:this.v,token:a.token})},this))};this.b=function(){this.a("DELETE","/login")};this.a=function(a,b,g,c,f){var m="application/x-www-form-urlencoded";void 0!==c&&"Content-Type"in c&&(m=c["Content-Type"]);return $.ajax({async:void 0===f?!0:f,contentType:m,data:g,headers:c,type:a,url:"api.php"+b})}};(function(a,b){b.commands["false"]=function(){return 1};b.commands["true"]=function(){return 0};b.commands.echo=function(a,b,f){f.shift();a[1].write(f.join(" "));return 0};b.commands["export"]=function(a,b,f,m){for(a=1;a<b;++a){var e=f[a].split("=",2);m[e[0]]=e[1]}return 0};b.commands.unset=function(a,b,f,m){for(a=1;a<b;++a)m[f[a]]="";return 0};b.commands.pwd=function(a,b,f,m){a[1].write(m.PWD);return 0};b.commands.help=function(a){a[2].write("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].write("To see a full list of commands, type 'commands' ");return 0};b.commands.commands=function(a){var c=[],f;for(f in b.commands)b.commands.hasOwnProperty(f)&&c.push(f);a[1].write(c.join("\n"));return 0};b.commands.whoami=function(a,b,f,m){a[1].write(m.USER);return 0};b.commands.sleep=function(b,c,f){if(2>c)return b[2].write("sleep: missing operand"),1;b=f[1][f[1].length-1];c=0;-1===["s","m","h","d"].indexOf(b)?(c=parseInt(f[1],10),b="s"):c=parseInt(f[1].substr(0,-1),10);switch(b){case "d":c*=
24;case "h":c*=60;case "m":c*=60;case "s":c*=1E3}var m=a.Deferred();setTimeout(function(){m.resolve(0)},c);return m.promise()};b.commands.date=function(b,c,f){1>=c&&f.push("+%c");c=new Date;var m="Sun Mon Tue Wed Thu Fri Sat".split(" "),e="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),l="January February March April May June July August September October November December".split(" "),k=f[1].split("");if("+"!==k[0])return b[2].write("date: invalid date format "+
f[1]),1;k.shift();for(f=k.indexOf("%");0<=f;f=k.indexOf("%",f+1)){var h="",p="0",n=1,t=[];"-"===k[f+n]?(++n,p=""):"_"===k[f+n]&&(++n,p=" ");switch(k[f+n++]){case "D":t="%m/%d/%y".split("");break;case "e":t=["%","_","d"];break;case "F":t="%Y-%m-%d".split("");break;case "k":t=["%","-","H"];break;case "l":t=["%","-","I"];break;case "R":t=["%","H",":","%","M"];break;case "T":t="%H:%M:%S".split("");break;case "%":h="%";break;case "a":h=m[c.getDay()];break;case "A":h=e[c.getDay()];break;case "b":case "h":h=
d[c.getMonth()];break;case "B":h=l[c.getMonth()];break;case "c":h=c.toLocaleString();break;case "C":h=c.getFullYear().toString().substr(0,2);break;case "d":h=c.getDate();break;case "H":h=c.getHours();break;case "I":h=c.getHours()%12;break;case "m":h=c.getMonth();break;case "M":h=c.getMinutes();break;case "n":h="\n";break;case "N":h=1E3*c.getMilliseconds();break;case "p":h=12<=c.getHours()?"PM":"AM";break;case "P":h=12<=c.getHours()?"pm":"am";break;case "s":h=c.getTime()/1E3;break;case "S":h=c.getSeconds();
break;case "t":h="\t";break;case "u":h=c.getDay()+1;break;case "w":h=c.getDay();break;case "x":h=c.toLocaleDateString();break;case "X":case "r":h=c.toLocaleTimeString();break;case "y":h=c.getFullYear()%100;break;case "Y":h=c.getFullYear();break;case "z":var q=c.getTimezoneOffset(),h=0<=q?"+":"-",h=h+(q/60+""+q%60);break;case "Z":h="EDT"}"number"===a.type(h)&&(h=v(h.toString(),2,p,"left"));Array.prototype.splice.apply(k,[f,n,h].concat(t))}b[1].write(k.join(""));return 0};b.commands.printf=function(b,
c,f){if(1>=c)return b[2].write("error in usage: printf FORMAT [ARGS ...]"),1;for(var m=1,e=f[1].split(""),d=e.indexOf("%");0<=d;d=e.indexOf("%",d+1)){var l="",k=1,h="",p=" ",n="right",t="0",q=null,s,l=e.indexOf("$",d+k);s=e.slice(d+k,l);-1===l||isNaN(s)?s=m++ +1:(++k,s=parseInt(s,10)+1);l=s<c?f[s]:"";a:for(;d+k<e.length;)switch(e[d+k]){case "+":++k;h="+";break;case " ":++k;h=" ";break;case "-":++k;n="left";break;case "0":++k;p="0";n="left";break;default:break a}for(;!isNaN(e[d+k]);)t+=e[d+k++];t=
parseInt(t,10);if("."===e[d+k]){++k;for(q="0";!isNaN(e[d+k]);)q+=e[d+k++];q=parseInt(q,10)}switch(e[d+k++]){case "d":case "i":l=parseInt(f[s],10);break;case "u":l=Math.abs(parseInt(f[s],10));break;case "f":case "F":case "g":case "G":l=parseFloat(f[s],10);break;case "x":case "X":l=parseInt(f[s],10).toString(16);break;case "o":l=parseInt(f[s],10).toString(8);break;case "s":l=f[s];break;case "c":l=f[s].substr(0,1);break;case "n":l="";break;case "%":t=0,q=null,l="%"}null!==q?"number"===a.type(l)?(0>l&&
(h=""),l=h+l.toFixed(q).toString()):l=l.substr(0,q):"number"===a.type(l)&&(0>l&&(h=""),l=h+l.toString());l=v(l,t,p,n);e.splice(d,k,l)}b[1].write(e.join(""));return 0}})(jQuery,x);(function(a,b){var g=new y;b.commands.cd=function(a,b,e,d){var c="",c=1>=b?d.HOME:"/"===e[1][0]?r(e[1]):r(e[1],d.PWD,d.HOME);b=g.a("GET","/files"+c,{},{},!1);if("directory"!==b.getResponseHeader("File-Type"))return a[2].write("cd: "+c+": Not a directory"),1;if(404===b.status)return a[2].write("cd: "+c+": No such file or directory"),1;if(403===b.status)return a[2].write("cd: "+c+": Permission denied"),1;if(200!==b.status)return a[2].write("cd: "+c+": An internal error occurred"),1;d.PWD=c;return 0};
var c;b.commands.ls=function(f,b,e,d){e=a.b(e,"latcurS");var l=e[0];e=e[1];b=e.length;if(1===b)e[b++]="";else if("string"===a.type(l))return f[2].write(l),1;b="name";"l"in l&&"t"in l?"c"in l?b="ctime":"u"in l&&(b="atime"):"t"in l?b="mtime":"S"in l&&(b="size");for(var k=1;k<e.length;k++){var h=r(e[k],d.PWD,d.HOME),p=g.a("GET","/files"+h,{},{"Sort-By":b},!1);if(null===p||200!==p.status)f[2].write("ls: cannot access "+h+": No such file or directory");else{if("directory"!==p.getResponseHeader("File-Type"))console.log(h),
p.responseJSON=[["f",p.getResponseHeader("File-Perms"),p.getResponseHeader("File-Owner"),p.getResponseHeader("File-Group"),p.getResponseHeader("Content-Length"),p.getResponseHeader("Last-Modified"),h]];else if(null===p.responseJSON||void 0===p.responseJSON)p.responseJSON=[];"r"in l&&p.responseJSON.reverse();var n="";c=p.responseJSON.length;for(h=counter=0;h<p.responseJSON.length;h++){var t=f[1],q=p.responseJSON[h],s=l;if("."!==q[6][0]||"a"in s)if(n=n+q[6]+"\t\t","l"in s){for(var n="d"===q[0]?"d":
"-",s=0,u=256;3>s;s++,u>>=1)n+=u&q[1]?"r":"-",u>>=1,n+=u&q[1]?"w":"-",u>>=1,n+=u&q[1]?"x":"-";n+=" "+v(q[2],10);n+=" "+v(q[3],6);n+=" "+v(q[4].toString(),6);n+=" "+q[5].date;n+=" "+q[6];n+="\n";t.write(n);n=""}else{if(counter++,0===counter%4||counter===c)n+="\n",t.write(n),n=""}else c--}}}return 0};b.commands.ln=function(a,b,e,d){3!==b&&a[2].write("ln: invalid number of parameters");b=r(e[1],d.PWD,d.HOME);e=r(e[2],d.PWD,d.HOME);d=g.a("PUT","/files"+e,"",{"File-Type":"link","Content-Location":b},!1);
return 404===d.status?(a[2].write("ln: failed to create symbolic link "+e+": No such file or directory"),1):403===d.status?(a[2].write("ln: failed to create symbolic link "+e+": Permission denied"),1):400<=d.status?(a[2].write("ln: failed to create symbolic link "+e+": An internal error occurred"),1):0};b.commands.touch=function(a,b,e,d){for(var c=1;c<b;c++){var k=r(e[c],d.PWD,d.HOME),h=g.a("POST","/files"+k,"",{},!1);if(404===h.status)return a[2].write("touch: cannot touch "+k+": No such file or directory"),
1;if(403===h.status)return a[2].write("touch: cannot touch "+k+": Permission denied"),1;if(400<=h.status)return a[2].write("touch: cannot touch "+k+": An internal error occurred"),1}return 0};b.commands.cat=function(a,b,e,d){1>=b&&(e.push("-"),++b);for(var c=!1,k=1;k<b;k++)if("-"===e[k])c=!0,a[0].n().progress(function(b){a[1].write(b.p())});else{var h=r(e[k],d.PWD,d.HOME);req=g.a("GET","/files"+h,"",{},!1);200===req.status?"directory"===req.getResponseHeader("File-Type")?a[2].write("cat: "+h+": Is a directory"):
"application/json"!==req.getResponseHeader("Content-Type")?a[1].write(req.responseText):a[1].write(req.responseJSON):404===req.status?a[2].write("cat: "+h+": No such file or directory"):403===req.status&&a[2].write("cat: "+h+": Permission denied")}return c?a[0].n():0};b.commands.mkdir=function(a,b,e,d){for(var c=1;c<b;c++){var k=r(e[c],d.PWD,d.HOME),h=g.a("GET","/files"+k,"",{},!1);404!==h.status&&a[2].write("mkdir: cannot create directory "+k+": File exists");h=g.a("PUT","/files"+k,"",{"File-Type":"directory"},
!1);if(404===h.status)return a[2].write("mkdir: cannot create directory "+k+": No such file or directory"),1;if(403===h.status)return a[2].write("mkdir: cannot create directory "+k+": Permission denied"),1;if(400<=h.status)return a[2].write("mkdir: cannot create directory "+k+": An internal error occurred"),1}return 0};b.commands.useradd=function(b,c,e,d){e=a.b(e,"d:g:G:mM");var l=e[0];e=e[1];c=e.length;if("string"===a.type(l))return b[2].write(l),1;if(2>c)return b[2].write("error in usage: useradd [OPTIONS] LOGIN [EMAIL]"),
1;3!==c&&e.push(e[1]+"@localhost");var k=g.a("GET","/users/"+e[1],"",{},!1);if(404!==k.status)return b[2].write("useradd: User "+e[1]+" already exists"),1;c="/home/"+e[1];"d"in l&&(c=l.d);c=r(c,d.PWD,d.HOME);if("m"in l&&!("M"in l)){k=g.a("PUT","/files"+c,"",{"File-Type":"directory"},!1);if(404===k.status)return b[2].write("useradd: cannot create directory "+path+": No such file or directory"),1;if(403===k.status)return b[2].write("useradd: cannot create directory "+path+": Permission denied"),1;if(400<=
k.status)return b[2].write("useradd: cannot create directory "+path+": An internal error occurred"),1}d=[];"g"in l&&d.push(l.g);"G"in l&&(d=a.merge(d,l.G.split(",")));k=g.a("PUT","/users/"+e[1],{password:"!",email:e[2],home_directory:c,groups:d},{},!1);if(400===k.status||404===k.status&&"Cannot find file or directory"===k.responseJSON)return b[2].write("useradd: invalid home directory"),1;if(403===k.status)return b[2].write("useradd: cannot create user: Permission denied"),1;if(500===k.status)return b[2].write("count not create user: server timed out"),
1;g.a("PATCH","/files"+c,"",{"File-Owner":e[1]},!1);return 0};b.commands.userdel=function(b,c,e){e=a.b(e,"r");var d=e[0];e=e[1];c=e.length;if(2>c)return b[2].write("error in usage: userdel [OPTIONS] LOGIN"),1;if("string"===a.type(d))return b[2].write(d),1;if("r"in d){d=g.a("GET","/users/"+e[1],"",{},!1);if(404===d.status)return b[2].write("userdel: User "+e[1]+" does not exist"),1;c=d.responseJSON.homedir;d=g.a("DELETE","/files"+c,"",{},!1);if(403===d.status)return b[2].write("userdel: Cannot delete home directory "+
c+": Permission denied"),1}d=g.a("DELETE","/users/"+e[1],"",{},!1);return 404===d.status?(b[2].write("userdel: User "+e[1]+" does not exist"),1):403===d.status?(b[2].write("userdel: cannot delete user: Permission denied"),1):0};b.commands.passwd=function(b,c,e,d,l){2>c&&(e.push(d.USER),++c);var k=a.Deferred();b[0].n().progress(function(a){a=a.p();l.m();a=g.a("PATCH","/users/"+e[1],{password:a},{},!1);400===a.status?(b[2].write("useradd: invalid home directory"),k.resolve(1)):403===a.status?(b[2].write("useradd: cannot create user: Permission denied"),
k.resolve(1)):500==a.status?(b[2].write("count not create user: server timed out"),k.resolve(1)):k.resolve(0)});b[1].write("Password: ");l.m();return k};b.commands.cp=function(a,b,c,d){3!==b&&a[2].write("cp: invalid number of parameters");b=r(c[1],d.PWD,d.HOME);c=r(c[2],d.PWD,d.HOME);d=g.a("PUT","/files"+c,b,{"Content-Type":"application/vnd.webbash.filepath"},!1);return 404===d.status?(a[2].write("cp: cannot create regular file "+c+": No such file or directory"),1):403===d.status?(a[2].write("cp: cannot create regular file "+
c+": Permission denied"),1):400<=d.status&&"Invalid file data source"===d.responseJSON?(a[2].write("cp: cannot stat "+b+": No such file or directory"),1):0};b.commands.mv=function(a,b,c,d){if(3!==b)return a[2].write("mv: invalid number of parameters"),1;b=r(c[1],d.PWD,d.HOME);c=r(c[2],d.PWD,d.HOME);d=g.a("PUT","/files"+c,b,{"Content-Type":"application/vnd.webbash.filepath"},!1);if(404===d.status)return a[2].write("mv: cannot create regular file "+c+": No such file or directory"),1;if(403===d.status)return a[2].write("mv: cannot create regular file "+
c+": Permission denied"),1;if(400<=d.status&&"Invalid file data source"===d.responseJSON)return a[2].write("mv: cannot stat "+b+": No such file or directory"),1;d=g.a("DELETE","/files"+b,"",{},!1);return 403===d.status?(a[2].write("mv: cannot remove "+b+": Permission denied"),1):0};b.commands.rmdir=function(a,b,c,d){for(var l=1;l<b;l++){var k=r(c[l],d.PWD,d.HOME),h=g.a("GET","/files"+k,{},{},!1);404===h.status?a[2].write("rmdir: cannot remove "+k+": No such directory"):403===h.status?a[2].write("rmdir: cannot remove "+
k+": Permission denied"):"directory"===h.getResponseHeader("File-Type")&&2===h.responseJSON.length?g.a("DELETE","/files"+k,"",{},!1):a[2].write("rmdir: cannot remove "+k+": Non-empty directory")}return 0};b.commands.rm=function(b,c,e,d){c=a.b(e,"r");var l=c[0];e=c[1];c=e.length;if("string"===a.type(l))return b[2].write(l),1;var k=!1,h;for(h in l)l.hasOwnProperty(h)&&"r"===h&&(k=!0);for(l=1;l<c;l++){h=r(e[l],d.PWD,d.HOME);var p=g.a("GET","/files"+h,{},{},!1);"directory"!==p.getResponseHeader("File-Type")||
k?(p=g.a("DELETE","/files"+h,"",{},!1),404===p.status?b[2].write("rm: cannot remove "+h+": No such file or directory"):403===p.status&&b[2].write("rm: cannot remove "+h+": Permission denied")):b[2].write("rm: cannot remove "+h+": File is a directory")}return 0};b.commands.chmod=function(a,b,c,d){if(3>b)return a[2].write("chown: needs at least 2 parameters"),1;for(var l=2;l<b;l++){var k=r(c[l],d.PWD,d.HOME),h=g.a("PATCH","/files"+k,"",{"File-Permissions":c[1]},!1);404===h.status?a[2].write("chown: cannot access "+
k+": No such file or directory"):403===h.status&&a[2].write("chown: changing permissions of "+k+": Permission denied")}return 0};b.commands.chgrp=function(a,b,c,d){if(3>b)return a[2].write("chown: needs at least 2 parameters"),1;for(var l=2;l<b;l++){var k=r(c[l],d.PWD,d.HOME),h=g.a("PATCH","/files"+k,"",{"File-Group":c[1]},!1);if(404===h.status)a[2].write("chown: cannot access "+k+": No such file or directory");else if(403===h.status)a[2].write("chown: changing ownership of "+k+": Permission denied");
else if(400<=h.status&&"Invalid group"===h.responseJSON)return a[2].write("chown: invalid group: "+c[1]),1}return 0};b.commands.chown=function(a,b,c,d){if(3>b)return a[2].write("chown: needs at least 2 parameters"),1;for(var l=2;l<b;l++){var k=r(c[l],d.PWD,d.HOME),h=g.a("PATCH","/files"+k,"",{"File-Owner":c[1]},!1);if(404===h.status)a[2].write("chown: cannot access "+k+": No such file or directory");else if(403===h.status)a[2].write("chown: changing ownership of "+k+": Permission denied");else if(400<=
h.status&&"Invalid owner"===h.responseJSON)return a[2].write("chown: invalid user: "+c[1]),1}return 0};b.commands.uname=function(b,c,e){c=a.b(e,"asnr")[0];if("string"===a.type(c))return b[2].write(c),1;e=g.a("GET","/","",{},!1);if(200!==e.status)return b[2].write("uname: cannot access server"),1;var d="";if("s"in c||"a"in c)d+=e.responseJSON.kernel+" ";if("n"in c||"a"in c)d+=e.responseJSON.hostname+" ";if("r"in c||"a"in c)d+=e.responseJSON.version+" ";b[1].write(d);return 0};b.commands.history=function(b,
c,e,d){if("c"in a.b(e,"c")[0]){if(c=g.a("DELETE","/users/"+d.USER+"/history","",{},!1),404===c.status||403===c.status)return b[2].write("history: invalid user in environment"),2}else{c=g.a("GET","/users/"+d.USER+"/history","",{},!1);if(404===c.status||403===c.status)return b[2].write("history: invalid user in environment"),2;c=c.responseJSON;for(e=0;e<c.length;++e)b[1].write("  "+e+"  "+c[e]+"\n")}return 0}})(jQuery,x);
