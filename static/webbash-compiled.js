function m(b){return function(){return b}}
(function(b){b.Event.prototype.u=function(){var a={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},d={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},e=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(e))return!1;"undefined"!==typeof d[e]&&(e=d[e]);d=String.fromCharCode(e);
this.shiftKey?"undefined"!==typeof a[d]&&(d=a[d]):d=d.toLowerCase();return d}})(jQuery);(function(b){b.c=function(a,d,e){var c=a[0];"~"===c?a=e+"/"+a:"/"!==c&&(a=d+"/"+a);a=a.substr(1).split("/");d=[];for(e=0;e<a.length;e++)"."!==a[e]&&""!==a[e]&&(".."===a[e]?d.pop():d.push(a[e]));return"/"+d.join("/")}})(jQuery);(function(b){function a(d,a,c){return c.indexOf(d)===a}b.w=function(d){var e=[],c;for(c in d)if(d.hasOwnProperty(c))for(var g=1;g<d[c].length;++g)e[e.length]=d[c][g];e.filter(a)}})(jQuery);window.Terminal=function(){this.e=null;this.prompt="root@ubuntu> ";this.d=[];this.g=0;this.r=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'));$(window).scrollTop($(document).height())};this.m=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.r()};this.t=function(b){var a=$('<div class="system_output"></div>');
a.text(b);$("body > ul > li:last-child").append(a);this.r()};this.blink=function(){$("#cursor").toggleClass("blink")};this.p=function(){var b=$("#cursor"),a,d,e=b.prev(),c=b.next();if(0===e.length||!e.hasClass("userinput"))return!1;var g=e.text();if(0===g.length)return!1;a=g.substr(g.length-1);d=b.text();0===c.length&&"&nbsp;"!==d&&(c=$('<div class="userinput"></div>'),b.after(c));e.text(g.substring(0,g.length-1));b.text(a);return"&nbsp;"!==d?(c.prepend(d),!0):!1};this.k=function(){var b=$("#cursor"),
a,d,e,c=b.prev(),g=b.next();if(0===g.length||!g.hasClass("userinput"))return!1;e=g.text();if(0===e.length)return!1;a=e[0];d=b.text();if(0===g.length)return b.html("&nbsp;"),!1;g.text(e.substr(1));b.text(a);c.append(d);return!0};this.o=function(b){var a=$("#cursor").parent().children(".userinput").text();this.d[this.g]=a.substr(0,a.length-1);b=this.g+b;b<this.d.length&&0<=b&&(this.g=b,b=$("#cursor"),b.next().text(""),b.html("&nbsp;"),b.prev().text(this.d[this.g]))};this.A=function(b){var a;if(37===
b.which)this.p();else if(39===b.which)this.k();else if(38===b.which)this.o(-1);else if(40===b.which)this.o(1);else if(35===b.which)for(;this.k(););else if(36===b.which)for(;this.p(););else if(!b.ctrlKey||b.metaKey||b.shiftKey||67!==b.which)if(46===b.which)if(a=$("#cursor"),b=a.next(),0!==b.length&&b.hasClass("userinput")){var d=b.text();0!==d.length?(a.text(d.substr(0,1)),b.text(d.substr(1))):a.html("&nbsp;")}else a.html("&nbsp;");else 8===b.which?(b.preventDefault(),a=$("#cursor").prev(),0<a.length&&
a.hasClass("userinput")&&a.text(a.text().slice(0,-1))):13===b.which?(a=$("#cursor").parent().children(".userinput").text(),a=a.substr(0,a.length-1),0<a.length&&(this.d[this.d.length]=a,this.g=this.d.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.e.execute($.trim(a),this).progress($.proxy(this.t,this)).always($.proxy(this.m,this))):222===b.which&&b.shiftKey?(b.preventDefault(),a=$("#cursor").prev(),a.append('"'),this.k()):222===b.which?(b.preventDefault(),
a=$("#cursor").prev(),a.append("'"),this.k()):(a=$("#cursor").prev(),(b=b.u())&&a.append(b));else b.preventDefault(),$("#cursor").next().append("^C"),this.m();$(window).scrollTop($(document).height())};this.bind=function(b){null!==this.e&&$.proxy(this.e.l,this.e)(this);this.e=b;$.proxy(this.e.s,this.e)(this);this.m()};$(window.document).keydown($.proxy(this.A,this));$(window).bind("beforeunload",function(){$.proxy(this.e.l,this.e)(this)});window.setInterval(this.blink,500);window.setInterval($.proxy(function(){this.e.l(this)},
this),1E4)};function n(b){this.f={"?":"0"};this.C=/[\w\?\-\!]+/i;this.b=b;this.j=0;this.h=new p;this.s=function(a){var d=this.h.a("GET","/users/"+this.b,{},{},!1),e=this.h.a("GET","/users/"+this.b+"/history",{},{},!1),d=d.responseJSON.homedir;this.f.USER=this.b;this.f.HOME=d;this.f.PWD=d;a.prompt=this.b+"@ubuntu "+d+" $ ";200===e.status&&(a.d=e.responseJSON,this.j=a.g=e.responseJSON.length)};this.l=function(a){this.j<a.d.length&&(this.h.a("PATCH","/users/"+this.b+"/history",{history:a.d.slice(this.j)}),this.j=
a.d.length)};this.execute=function(a,d){var e=$.Deferred();setTimeout($.proxy(function(){var c=this.B(this.splitText(a));this.n(c,d,e)},this),0);return e.promise()};this.n=function(a,d,e){var c;"undefined"!==typeof n.commands[a[0]]?(c=[new q,new q,new q],c[1].flush=function(a){e.notify([a])},c[2].flush=function(a){e.notify([a])},c=n.commands[a[0]](c,a.length,a,this.f)):void 0!==a[0]&&""!==a[0]&&(e.notify(["error: unknown command "+a[0]]),c="127");updateFunc=$.proxy(function(a){this.f["?"]=a.toString();
d.prompt=this.b+"@ubuntu "+this.f.PWD+" $ ";e.resolve()},this);"object"===$.type(c)&&void 0!==c.then?c.then(updateFunc):updateFunc()};this.B=function(a){for(var d=1;d<a.length;++d)for(var e=a[d].indexOf("$");0<=e;e=a[d].indexOf("$",e+1))if(0!==e&&"\\"===a[d][e-1])a[d]=a[d].substr(0,e-1)+a[d].substr(e);else{var c=this.C.exec(a[d].substr(e+1))[0];null!==c&&("undefined"===typeof this.f[c]&&(this.f[c]=""),a[d]=a[d].substr(0,e)+this.f[c]+a[d].substr(e+c.length+1))}return a};this.splitText=function(a){for(var d=
"",e=[],c=!1,b=!1,f=!1,h=0;h<a.length;h++)" "===a[h]&&(c||b)?d+=a[h]:" "!==a[h]||c||b?"\\"===a[h]?f||c?(d+="\\",f=!1):f=!0:"'"===a[h]?f?(d+="'",f=!1):b?d+="'":c=!c:'"'===a[h]?f?(d+='"',f=!1):c?d+='"':b=!b:"$"===a[h]&&c?d+="\\$":(d+=a[h],f=!1):0<d.length&&(e.push(d),d="");d=$.trim(d);""!==d&&e.push(d);return e}}n.commands={};window.WebBash=n;window.WebBashLogin=function(){this.h=new p;this.b="";this.s=function(b){b.prompt="Username: "};this.l=function(){};this.execute=function(b,a){var d=$.Deferred();setTimeout($.proxy(function(){this.n(b,a,d)},this),0);return d.promise()};this.n=function(b,a,d){""===this.b?(this.b=b,""!==b&&(a.prompt="Password: "),d.resolve()):this.h.v(this.b,b).done($.proxy(function(){a.bind(new n(this.b))},this)).fail($.proxy(function(e){d.notify(e.responseText);this.b="";a.prompt="Username: ";d.resolve()},this))}};function q(){this.i=0;this.buffer="";this.write=function(b){this.buffer+=b;this.flush(this.buffer)};this.F=function(b){if(this.i>=this.buffer.length)return!1;if(void 0===b)return this.i=this.buffer.length,this.D;var a=this.buffer.substr(this.i,b);this.i+=b;return a};this.flush=function(){}};function p(){this.q=this.b="";this.v=function(b,a){this.b=b;this.q=a;return this.a("GET","/login").then($.proxy(function(a){return this.a("POST","/login",{username:this.b,password:this.q,token:a.token})},this))};this.a=function(b,a,d,e,c){var g="application/x-www-form-urlencoded";void 0!==e&&"Content-Type"in e&&(g=e["Content-Type"]);return $.ajax({async:void 0===c?!0:c,contentType:g,data:d,headers:e,type:b,url:"api.php"+a})}};(function(b,a){a.commands["false"]=m(1);a.commands["true"]=m(0);a.commands.echo=function(a,e,c){c.shift();a[1].write(c.join(" "));return 0};a.commands["export"]=function(a,e,c,b){for(a=1;a<e;++a){var f=c[a].split("=",2);b[f[0]]=f[1]}return 0};a.commands.unset=function(a,e,c,b){for(a=1;a<e;++a)b[c[a]]="";return 0};a.commands.pwd=function(a,e,c,b){a[1].write(b.PWD);return 0};a.commands.help=function(a){a[2].write("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].write("To see a full list of commands, type 'commands' ");return 0};a.commands.commands=function(d){var e=[],c;for(c in a.commands)a.commands.hasOwnProperty(c)&&e.push(c);d[1].write(e.join("\n"));return 0};a.commands.whoami=function(a,e,c,b){a[1].write(b.USER);return 0};a.commands.sleep=function(a,e,c){if(2>c.length)return a[2].write("sleep: missing operand"),1;a=c[1][c[1].length-1];e=0;-1===["s","m","h","d"].indexOf(a)?(e=parseInt(c[1]),a="s"):e=parseInt(c[1].substr(0,-1));switch(a){case "d":e*=
24;case "h":e*=60;case "m":e*=60;case "s":e*=1E3}var g=b.Deferred();setTimeout(function(){g.resolve(0)},e);return g.promise()};a.commands.date=function(a,e){if(1<e)return a[2].write("error: date takes no args"),1;var c=new Date,b=Array(7);b[0]="Sun";b[1]="Mon";b[2]="Tue";b[3]="Wed";b[4]="Thu";b[5]="Fri";b[6]="Sat";var f=Array(12);f[0]="Jan";f[1]="Feb";f[2]="Mar";f[3]="Apr";f[4]="May";f[5]="Jun";f[6]="Jul";f[7]="Aug";f[8]="Sep";f[9]="Oct";f[10]="Nov";f[11]="Dec";var h="UTC";4===c.getTimezoneOffset()/
60&&(h="EDT");var b=b[c.getDay()].toString()+" "+f[c.getMonth()].toString()+" "+c.getDate().toString()+" ",k=c.getHours(),f=k.toString();10>k&&(f="0"+k.toString());var l=c.getMinutes(),k=l.toString();10>l&&(k="0"+l.toString());var l=c.getSeconds(),r=l.toString();10>l&&(r="0"+l.toString());b+=f+":"+k+":"+r+" "+h+" "+c.getFullYear().toString()+" ";a[1].write(b);return 0}})(jQuery,n);(function(b,a){var d=new p;a.commands.cd=function(a,c,g,f){var h="",h=1>=c?f.HOME:b.c(g[1],f.PWD,f.HOME);c=d.a("GET","/files"+h,{},{},!1);if(200===c.status)return f.PWD=h,0;404===c.status?a[2].write("cd: "+h+": No such file or directory"):403===c.status?a[2].write("cd: "+h+": Permission denied"):a[2].write("cd: "+h+": An internal error occurred");return 1};a.commands.ls=function(a,c,g,f){var h=[],k=[];c=/-[\w]+/;for(var l in g)c.test(g[l])?h[h.length]=g[l]:k[k.length]=g[l];c=k.length;b.w(h);1===c&&
(k[c]=f.PWD,c++);for(g=1;g<c;g++)for(f=d.a("GET","/files"+k[1],{},{},!1),h=0;h<f.responseJSON.length;h++)console.log(f.responseJSON),a[1].write(f.responseJSON[h]+"\n");return 0};a.commands.ln=function(a,c,g,f){3!==c&&a[2].write("ln: invalid number of parameters");c=b.c(g[1],f.PWD,f.HOME);g=b.c(g[2],f.PWD,f.HOME);f=d.a("PUT","/files"+g,"",{"File-Type":"link","Content-Location":c},!1);return 404===f.status?(a[2].write("ln: failed to create symbolic link "+g+": No such file or directory"),1):403===f.status?
(a[2].write("ln: failed to create symbolic link "+g+": Permission denied"),1):400<=f.status?(a[2].write("ln: failed to create symbolic link "+g+": An internal error occurred"),1):0};a.commands.touch=function(a,c,g,f){for(var h=1;h<c;h++){var k=b.c(g[h],f.PWD,f.HOME),l=d.a("POST","/files"+k,"",{},!1);if(404===l.status)return a[2].write("touch: cannot touch "+k+": No such file or directory"),1;if(403===l.status)return a[2].write("touch: cannot touch "+k+": Permission denied"),1;if(400<=l.status)return a[2].write("touch: cannot touch "+
k+": An internal error occurred"),1}return 0};a.commands.mkdir=function(a,c,g,f){for(var h=1;h<c;h++){var k=b.c(g[h],f.PWD,f.HOME),l=d.a("PUT","/files"+k,"",{"File-Type":"directory"},!1);if(404===l.status)return a[2].write("mkdir: cannot create directory "+k+": No such file or directory"),1;if(403===l.status)return a[2].write("mkdir: cannot create directory "+k+": Permission denied"),1;if(400<=l.status)return a[2].write("mkdir: cannot create directory "+k+": An internal error occurred"),1}return 0};
a.commands.cp=function(a,c,g,f){3!==c&&a[2].write("cp: invalid number of parameters");c=b.c(g[1],f.PWD,f.HOME);g=b.c(g[2],f.PWD,f.HOME);f=d.a("PUT","/files"+g,c,{"Content-Type":"application/vnd.webbash.filepath"},!1);return 404===f.status?(a[2].write("cp: cannot create regular file "+g+": No such file or directory"),1):403===f.status?(a[2].write("cp: cannot create regular file "+g+": Permission denied"),1):400<=f.status&&"Invalid file data source"===f.responseJSON?(a[2].write("cp: cannot stat "+c+
": No such file or directory"),1):0};a.commands.mv=function(a,c,g,f){3!==c&&a[2].write("mv: invalid number of parameters");c=b.c(g[1],f.PWD,f.HOME);g=b.c(g[2],f.PWD,f.HOME);f=d.a("PUT","/files"+g,c,{"Content-Type":"application/vnd.webbash.filepath"},!1);if(404===f.status)return a[2].write("mv: cannot create regular file "+g+": No such file or directory"),1;if(403===f.status)return a[2].write("mv: cannot create regular file "+g+": Permission denied"),1;if(400<=f.status&&"Invalid file data source"===
f.responseJSON)return a[2].write("mv: cannot stat "+c+": No such file or directory"),1;f=d.a("DELETE","/files"+c,"",{},!1);return 403===f.status?(a[2].write("mv: cannot remove "+c+": Permission denied"),1):0};a.commands.rm=m(0);a.commands.chmod=m(0);a.commands.chgrp=function(a,c,g,f){if(3>c)return a[2].write("chown: needs at least 2 parameters"),1;for(var h=2;h<c;h++){var k=b.c(g[h],f.PWD,f.HOME),l=d.a("PATCH","/files"+k,"",{"File-Group":g[1]},!1);if(404===l.status)a[2].write("chown: cannot access "+
k+": No such file or directory");else if(403===l.status)a[2].write("chown: changing ownership of "+k+": Permission denied");else if(400<=l.status&&"Invalid group"===l.responseJSON)return a[2].write("chown: invalid group: "+g[1]),1}return 0};a.commands.chown=function(a,c,g,f){if(3>c)return a[2].write("chown: needs at least 2 parameters"),1;for(var h=2;h<c;h++){var k=b.c(g[h],f.PWD,f.HOME),l=d.a("PATCH","/files"+k,"",{"File-Owner":g[1]},!1);if(404===l.status)a[2].write("chown: cannot access "+k+": No such file or directory");
else if(403===l.status)a[2].write("chown: changing ownership of "+k+": Permission denied");else if(400<=l.status&&"Invalid owner"===l.responseJSON)return a[2].write("chown: invalid user: "+g[1]),1}return 0}})(jQuery,n);
