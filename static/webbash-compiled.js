(function(b){b.Event.prototype.a=function(){var a={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},d={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,173:45,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},f=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(f))return!1;"undefined"!==typeof d[f]&&(f=d[f]);d=String.fromCharCode(f);
this.shiftKey?"undefined"!==typeof a[d]&&(d=a[d]):d=d.toLowerCase();return d}})(jQuery);(function(b){b.a=function(a,d,f){var c=a[0];"~"===c?a=f+"/"+a:"/"!==c&&(a=d+"/"+a);a=a.substr(1).split("/");d=[];for(f=0;f<a.length;f++)"."!==a[f]&&""!==a[f]&&(".."===a[f]?d.pop():d.push(a[f]));return"/"+d.join("/")}})(jQuery);(function(b){b.b=function(a,d,f,c){"undefined"===typeof d&&(d=0);"undefined"===typeof f&&(f=" ");"undefined"===typeof c&&(c=b.b.d);if(d+1>=a.length)switch(c){case b.b.a:a=Array(d+1-a.length).join(f)+a;break;case b.b.b:d=d-a.length;c=Math.ceil(d/2);a=Array(d-c+1).join(f)+a+Array(c+1).join(f);break;default:a=a+Array(d+1-a.length).join(f)}return a};b.b.a=1;b.b.d=2;b.b.b=3})(jQuery);(function(b){b.d=function(a,d){for(var f={},c=[a[0]],g=1;g<a.length;g++){if("-"!==a[g][0])if("+"===d[0]){c=b.merge(c,a.slice(g));break}else{c.push(a[g]);continue}else if("--"===a[g]){c=b.merge(c,a.slice(g));break}var e=a[g].substr(1),h=d.indexOf(e);if(-1===h)return"Unknown option -"+e;if(":"===d[h+1])if("-"!==a[g+1][0])f[e]=a[++g];else{if(":"!==d[h+2])return"Option -"+e+" requires an argument";f[e]=!0}else f[e]=!0}return[f,c]}})(jQuery);window.Terminal=function(){this.f=null;this.b="root@ubuntu> ";this.a=[];this.d=0;this.m=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));"Password: "!==this.b?($("#cursor").before($('<div class="userinput"></div>')),$("#cursor").after($('<div class="userinput></div>'))):($("#cursor").before($('<div id="hiddentext" class="userinput"></div>')),$("#cursor").after($('<div id="hiddentext" class="userinput"></div>')));$(window).scrollTop($(document).height())};
this.p=function(){$("body > ul").empty()};this.h=function(){$("body > ul").append("<li>"+this.b+"</li>");this.m()};this.q=function(b){var a=$('<div id="system_output"></div>');a.text(b);$("body > ul > li:last-child").append(a);this.m()};this.o=function(){$("#cursor").toggleClass("blink")};this.l=function(){var b=$("#cursor"),a,d,f=b.prev(),c=b.next();if(0===f.length||!f.hasClass("userinput"))return!1;var g=f.text();if(0===g.length)return!1;a=g.substr(g.length-1);d=b.text();0===c.length&&"&nbsp;"!==
d&&(c=$('<div class="userinput"></div>'),b.after(c));f.text(g.substring(0,g.length-1));b.text(a);return"&nbsp;"!==d?(c.prepend(d),!0):!1};this.i=function(){var b=$("#cursor"),a,d,f,c=b.prev(),g=b.next();if(0===g.length||!g.hasClass("userinput"))return!1;f=g.text();if(0===f.length)return!1;a=f[0];d=b.text();if(0===g.length)return b.html("&nbsp;"),!1;g.text(f.substr(1));b.text(a);c.append(d);return!0};this.j=function(b){var a=$("#cursor").parent().children(".userinput").text();this.a[this.d]=a.substr(0,
a.length-1);b=this.d+b;b<this.a.length&&0<=b&&(this.d=b,b=$("#cursor"),b.next().text(""),b.html("&nbsp;"),b.prev().text(this.a[this.d]))};this.r=function(b){var a;if(37===b.which)b.preventDefault(),this.l();else if(39===b.which)b.preventDefault(),this.i();else if(38===b.which)b.preventDefault(),this.j(-1);else if(40===b.which)b.preventDefault(),this.j(1);else if(35===b.which)for(;this.i(););else if(36===b.which)for(;this.l(););else if(!b.ctrlKey||b.metaKey||b.shiftKey||67!==b.which)if(!b.ctrlKey||
b.metaKey||b.shiftKey||68!==b.which)if(46===b.which)if(a=$("#cursor"),b=a.next(),0!==b.length&&b.hasClass("userinput")){var d=b.text();0!==d.length?(a.text(d.substr(0,1)),b.text(d.substr(1))):a.html("&nbsp;")}else a.html("&nbsp;");else 8===b.which?(b.preventDefault(),a=$("#cursor").prev(),0<a.length&&a.hasClass("userinput")&&a.text(a.text().slice(0,-1))):13===b.which?(a=$("#cursor").parent().children(".userinput").text(),a=a.substr(0,a.length-1),a=$.trim(a),0<a.length&&(this.a[this.a.length]=a,this.d=
this.a.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),0<a.length?this.f.h($.trim(a),this).progress($.proxy(this.q,this)).always($.proxy(this.h,this)):this.h()):222===b.which&&b.shiftKey?(b.preventDefault(),a=$("#cursor").prev(),a.append('"'),this.i()):222===b.which?(b.preventDefault(),a=$("#cursor").prev(),a.append("'"),this.i()):(a=$("#cursor").prev(),(b=b.a())&&a.append(b));else b.preventDefault(),this.f.b(this),this.f.a.a(),window.open("","_self",
""),window.close(),self.close();else b.preventDefault(),$("#cursor").next().append("^C"),this.h();$(window).scrollTop($(document).height())};this.bind=function(b){null!==this.f&&this.f.b.call(this.f,this);this.f=b;this.f.i.call(this.f,this);this.h()};$(window.document).keydown($.proxy(this.r,this));$(window).bind("beforeunload",function(){this.f.b.call(this.f,this)});window.setInterval(this.o,500);window.setInterval($.proxy(function(){this.f.b(this)},this),1E4)};function q(b){this.g={"?":"0"};this.j=/[\w\?\-\!]+/i;this.e=b;this.d=0;this.a=new s;this.i=function(a){var d=this.a.c("GET","/users/"+this.e,{},{},!1),f=this.a.c("GET","/users/"+this.e+"/history",{},{},!1),d=d.responseJSON.homedir;this.g.USER=this.e;this.g.HOME=d;this.g.PWD=d;a.b=this.e+"@ubuntu "+d+" $ ";200===f.status&&(a.a=f.responseJSON,this.d=a.d=f.responseJSON.length)};this.b=function(a){this.d<a.a.length&&(this.a.c("PATCH","/users/"+this.e+"/history",{history:a.a.slice(this.d)}),this.d=a.a.length)};
this.h=function(a,d){var f=$.Deferred();setTimeout($.proxy(function(){var c=this.s(this.splitText(a));this.k(c,d,f)},this),0);return f.promise()};this.k=function(a,d,f){var c;"exit"===a[0]?(this.b(d),this.a.a(),window.open("","_self",""),window.close(),self.close()):"clear"===a[0]?d.p():"undefined"!==typeof q.commands[a[0]]?(c=[new t,new t,new t],c[1].flush=function(a){f.notify([a]);this.buffer=""},c[2].flush=function(a){f.notify([a]);this.buffer=""},c=q.commands[a[0]](c,a.length,a,this.g)):void 0!==
a[0]&&""!==a[0]&&(f.notify(["error: unknown command "+a[0]]),c="127");a=$.proxy(function(a){this.g["?"]=a.toString();d.b=this.e+"@ubuntu "+this.g.PWD+" $ ";f.resolve()},this);"object"===$.type(c)&&void 0!==c.then?c.then(a):a(c)};this.s=function(a){for(var d=1;d<a.length;++d)for(var f=a[d].indexOf("$");0<=f;f=a[d].indexOf("$",f+1))if(0!==f&&"\\"===a[d][f-1])a[d]=a[d].substr(0,f-1)+a[d].substr(f);else{var c=this.j.exec(a[d].substr(f+1))[0];null!==c&&("undefined"===typeof this.g[c]&&(this.g[c]=""),a[d]=
a[d].substr(0,f)+this.g[c]+a[d].substr(f+c.length+1))}return a};this.splitText=function(a){for(var d="",f=[],c=!1,b=!1,e=!1,h=0;h<a.length;h++)" "===a[h]&&(c||b)?d+=a[h]:" "!==a[h]||c||b?"\\"===a[h]?e||c?(d+="\\",e=!1):e=!0:"'"===a[h]?e?(d+="'",e=!1):b?d+="'":c=!c:'"'===a[h]?e?(d+='"',e=!1):c?d+='"':b=!b:"$"===a[h]&&c?d+="\\$":(d+=a[h],e=!1):0<d.length&&(f.push(d),d="");d=$.trim(d);""!==d&&f.push(d);return f}}q.commands={};window.WebBash=q;window.WebBashLogin=function(){this.a=new s;this.e="";this.i=function(b){b.b="Username: "};this.b=function(){};this.h=function(b,a){var d=$.Deferred();setTimeout($.proxy(function(){this.k(b,a,d)},this),0);return d.promise()};this.k=function(b,a,d){""===this.e?(this.e=b,""!==b&&(a.b="Password: "),d.resolve()):this.a.b(this.e,b).done($.proxy(function(){a.bind(new q(this.e))},this)).fail($.proxy(function(f){d.notify(f.responseText);this.e="";a.b="Username: ";d.resolve()},this))}};function t(){this.buffer="";this.a=function(b){this.buffer+=b;this.flush.call(this,this.buffer)};this.b=function(){this.buffer=""};this.flush=function(){this.buffer=""}};function s(){this.n=this.e="";this.b=function(b,a){this.e=b;this.n=a;return this.c("GET","/login").then($.proxy(function(a){return this.c("PUT","/login",{username:this.e,password:this.n,token:a.token})},this))};this.a=function(){this.c("DELETE","/login")};this.c=function(b,a,d,f,c){var g="application/x-www-form-urlencoded";void 0!==f&&"Content-Type"in f&&(g=f["Content-Type"]);return $.ajax({async:void 0===c?!0:c,contentType:g,data:d,headers:f,type:b,url:"api.php"+a})}};(function(b,a){a.commands["false"]=function(){return 1};a.commands["true"]=function(){return 0};a.commands.echo=function(a,f,c){c.shift();a[1].a(c.join(" "));return 0};a.commands["export"]=function(a,f,c,b){for(a=1;a<f;++a){var e=c[a].split("=",2);b[e[0]]=e[1]}return 0};a.commands.unset=function(a,f,c,b){for(a=1;a<f;++a)b[c[a]]="";return 0};a.commands.pwd=function(a,f,c,b){a[1].a(b.PWD);return 0};a.commands.help=function(a){a[2].a("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].a("To see a full list of commands, type 'commands' ");return 0};a.commands.commands=function(b){var f=[],c;for(c in a.commands)a.commands.hasOwnProperty(c)&&f.push(c);b[1].a(f.join("\n"));return 0};a.commands.whoami=function(a,f,c,b){a[1].a(b.USER);return 0};a.commands.sleep=function(a,f,c){if(2>f)return a[2].a("sleep: missing operand"),1;a=c[1][c[1].length-1];f=0;-1===["s","m","h","d"].indexOf(a)?(f=parseInt(c[1],10),a="s"):f=parseInt(c[1].substr(0,-1),10);switch(a){case "d":f*=24;case "h":f*=
60;case "m":f*=60;case "s":f*=1E3}var g=b.Deferred();setTimeout(function(){g.resolve(0)},f);return g.promise()};a.commands.date=function(a,f){if(1<f)return a[2].a("error: date takes no args"),1;var c=new Date,b=Array(7);b[0]="Sun";b[1]="Mon";b[2]="Tue";b[3]="Wed";b[4]="Thu";b[5]="Fri";b[6]="Sat";var e=Array(12);e[0]="Jan";e[1]="Feb";e[2]="Mar";e[3]="Apr";e[4]="May";e[5]="Jun";e[6]="Jul";e[7]="Aug";e[8]="Sep";e[9]="Oct";e[10]="Nov";e[11]="Dec";var h="UTC";4===c.getTimezoneOffset()/60&&(h="EDT");var b=
b[c.getDay()].toString()+" "+e[c.getMonth()].toString()+" "+c.getDate().toString()+" ",k=c.getHours(),e=k.toString();10>k&&(e="0"+k.toString());var l=c.getMinutes(),k=l.toString();10>l&&(k="0"+l.toString());var l=c.getSeconds(),m=l.toString();10>l&&(m="0"+l.toString());b+=e+":"+k+":"+m+" "+h+" "+c.getFullYear().toString()+" ";a[1].a(b);return 0}})(jQuery,q);(function(b,a){var d=new s;a.commands.cd=function(a,c,g,e){var h="",h=1>=c?e.HOME:"/"===g[1][0]?b.a(g[1]):b.a(g[1],e.PWD,e.HOME);c=d.c("GET","/files"+h,{},{},!1);if(200===c.status)return e.PWD=h,0;404===c.status?a[2].a("cd: "+h+": No such file or directory"):403===c.status?a[2].a("cd: "+h+": Permission denied"):a[2].a("cd: "+h+": An internal error occurred");return 1};a.commands.ls=function(a,c,g,e){g=b.d(g,"la");var h=g[0];g=g[1];c=g.length;1===c&&(g[c++]="");for(c=1;c<g.length;c++){var k=b.a(g[c],
e.PWD,e.HOME),l=d.c("GET","/files"+k,{},{},!1);if(404===l.status)a[2].a("ls: cannot access "+k+": No such file or directory");else{"string"===typeof l.responseJSON&&(l.responseJSON=[l.responseJSON]);for(var m="",k=0,v=l.responseJSON.length-1;k<l.responseJSON.length;k++,v--){var r=a[1],n=l.responseJSON[k],w=h,m=m+n[6]+"\t\t",p=!0,x=!1,u=void 0;for(u in w)if(w.hasOwnProperty(u))switch(u){case "a":x=!0;break;case "l":for(var m="d"===n[0]?"d":"-",p=256,y=0;3>y;y++)m=p&n[1]?m+"r":m+"-",p>>=1,m=p&n[1]?
m+"w":m+"-",p>>=1,m=p&n[1]?m+"x":m+"-";m+=" "+b.b(n[2],10," ",b.b.a);m+=" "+b.b(n[3],6," ",b.b.a);m+=" "+b.b(n[4].toString(),6," ",b.b.a);m+=" "+n[5].date;m+=" "+n[6];p=!1}if("."!==n[6]&&".."!==n[6]||x)p?(m+="\n   ",0===v%4&&(r.a(m),r.b(),m="")):(m+="\n",r.a(m),r.b(),m="")}}}return 0};a.commands.ln=function(a,c,g,e){3!==c&&a[2].a("ln: invalid number of parameters");c=b.a(g[1],e.PWD,e.HOME);g=b.a(g[2],e.PWD,e.HOME);e=d.c("PUT","/files"+g,"",{"File-Type":"link","Content-Location":c},!1);return 404===
e.status?(a[2].a("ln: failed to create symbolic link "+g+": No such file or directory"),1):403===e.status?(a[2].a("ln: failed to create symbolic link "+g+": Permission denied"),1):400<=e.status?(a[2].a("ln: failed to create symbolic link "+g+": An internal error occurred"),1):0};a.commands.touch=function(a,c,g,e){for(var h=1;h<c;h++){var k=b.a(g[h],e.PWD,e.HOME),l=d.c("POST","/files"+k,"",{},!1);if(404===l.status)return a[2].a("touch: cannot touch "+k+": No such file or directory"),1;if(403===l.status)return a[2].a("touch: cannot touch "+
k+": Permission denied"),1;if(400<=l.status)return a[2].a("touch: cannot touch "+k+": An internal error occurred"),1}return 0};a.commands.cat=function(a,c,g,e){if(1>=c)return a[2].a("cat: invalid number of parameters"),1;for(var h=1;h<c;h++){var k=b.a(g[h],e.PWD,e.HOME);req=d.c("GET","/files"+k,"",{},!1);200===req.status?"directory"===req.getResponseHeader("File-Type")?a[2].a("cat: "+k+": Is a directory"):a[1].a(req.responseText):404===req.status?a[2].a("cat: "+k+": No such file or directory"):403===
req.status&&a[2].a("cat: "+k+": Permission denied")}return 0};a.commands.mkdir=function(a,c,g,e){for(var h=1;h<c;h++){var k=b.a(g[h],e.PWD,e.HOME),l=d.c("PUT","/files"+k,"",{"File-Type":"directory"},!1);if(404===l.status)return a[2].a("mkdir: cannot create directory "+k+": No such file or directory"),1;if(403===l.status)return a[2].a("mkdir: cannot create directory "+k+": Permission denied"),1;if(400<=l.status)return a[2].a("mkdir: cannot create directory "+k+": An internal error occurred"),1}return 0};
a.commands.useradd=function(a,b,g){if(2!==b)return a[2].a("error in usage: useradd LOGIN [EMAIL]"),1;3!==b&&g.push(g[1]+"@localhost");b=d.c("PUT","/users/"+g[1],{password:"!",email:g[2],home_directory:"/"+g[1]},{},!1);return 400===b.status?(a[2].a("useradd: invalid home directory"),1):403===b.status?(a[2].a("useradd: cannot create user: Permission denied"),1):500==b.status?(a[2].a("count not create user: server timed out"),1):0};a.commands.cp=function(a,c,g,e){3!==c&&a[2].a("cp: invalid number of parameters");
c=b.a(g[1],e.PWD,e.HOME);g=b.a(g[2],e.PWD,e.HOME);e=d.c("PUT","/files"+g,c,{"Content-Type":"application/vnd.webbash.filepath"},!1);return 404===e.status?(a[2].a("cp: cannot create regular file "+g+": No such file or directory"),1):403===e.status?(a[2].a("cp: cannot create regular file "+g+": Permission denied"),1):400<=e.status&&"Invalid file data source"===e.responseJSON?(a[2].a("cp: cannot stat "+c+": No such file or directory"),1):0};a.commands.mv=function(a,c,g,e){3!==c&&a[2].a("mv: invalid number of parameters");
c=b.a(g[1],e.PWD,e.HOME);g=b.a(g[2],e.PWD,e.HOME);e=d.c("PUT","/files"+g,c,{"Content-Type":"application/vnd.webbash.filepath"},!1);if(404===e.status)return a[2].a("mv: cannot create regular file "+g+": No such file or directory"),1;if(403===e.status)return a[2].a("mv: cannot create regular file "+g+": Permission denied"),1;if(400<=e.status&&"Invalid file data source"===e.responseJSON)return a[2].a("mv: cannot stat "+c+": No such file or directory"),1;e=d.c("DELETE","/files"+c,"",{},!1);return 403===
e.status?(a[2].a("mv: cannot remove "+c+": Permission denied"),1):0};a.commands.rm=function(a,c,g,e){for(var h=1;h<c;h++){var k=b.a(g[h],e.PWD,e.HOME);req=d.c("DELETE","/files"+k,"",{},!1);404===req.status?a[2].a("mv: cannot remove "+src+": No such file or directory"):403===req.status&&a[2].a("mv: cannot remove "+src+": Permission denied")}return 0};a.commands.chmod=function(){return 0};a.commands.chgrp=function(a,c,g,e){if(3>c)return a[2].a("chown: needs at least 2 parameters"),1;for(var h=2;h<c;h++){var k=
b.a(g[h],e.PWD,e.HOME),l=d.c("PATCH","/files"+k,"",{"File-Group":g[1]},!1);if(404===l.status)a[2].a("chown: cannot access "+k+": No such file or directory");else if(403===l.status)a[2].a("chown: changing ownership of "+k+": Permission denied");else if(400<=l.status&&"Invalid group"===l.responseJSON)return a[2].a("chown: invalid group: "+g[1]),1}return 0};a.commands.chown=function(a,c,g,e){if(3>c)return a[2].a("chown: needs at least 2 parameters"),1;for(var h=2;h<c;h++){var k=b.a(g[h],e.PWD,e.HOME),
l=d.c("PATCH","/files"+k,"",{"File-Owner":g[1]},!1);if(404===l.status)a[2].a("chown: cannot access "+k+": No such file or directory");else if(403===l.status)a[2].a("chown: changing ownership of "+k+": Permission denied");else if(400<=l.status&&"Invalid owner"===l.responseJSON)return a[2].a("chown: invalid user: "+g[1]),1}return 0};a.commands.uname=function(a,c,g){c=b.d(g,"asnr")[0];g=d.c("GET","/","",{},!1);if(200!==g.status)return a[2].a("uname: cannot access server"),1;var e="";if("s"in c||"a"in
c)e+=g.responseJSON.kernel+" ";if("n"in c||"a"in c)e+=g.responseJSON.hostname+" ";if("r"in c||"a"in c)e+=g.responseJSON.version+" ";a[1].a(e);return 0}})(jQuery,q);
