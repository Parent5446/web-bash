function m(b){return function(){return b}}
(function(b){b.Event.prototype.s=function(){var a={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},c={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},h=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(h))return!1;"undefined"!==typeof c[h]&&(h=c[h]);c=String.fromCharCode(h);
this.shiftKey?"undefined"!==typeof a[c]&&(c=a[c]):c=c.toLowerCase();return c}})(jQuery);(function(b){b.n=function(a){a=a.substr(1).split("/");for(var c=[],h=0;h<a.length;h++)"."!==a[h]&&""!==a[h]&&(".."===a[h]?c.pop():c.push(a[h]));return"/"+c.join("/")}})(jQuery);(function(b){function a(a,h,b){return b.indexOf(a)===h}b.u=function(c){var h=[],b;for(b in c)if(c.hasOwnProperty(b))for(var d=1;d<c[b].length;++d)h[h.length]=c[b][d];h.filter(a)}})(jQuery);window.Terminal=function(){this.g=null;this.prompt="root@ubuntu> ";this.d=[];this.e=0;this.o=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'))};this.i=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.o()};this.r=function(b){var a=$('<div class="system_output"></div>');a.text(b);$("body > ul > li:last-child").append(a);
this.o()};this.blink=function(){$("#cursor").toggleClass("blink")};this.l=function(){var b=$("#cursor"),a,c,h=b.prev(),f=b.next();if(0===h.length||!h.hasClass("userinput"))return!1;var d=h.text();if(0===d.length)return!1;a=d.substr(d.length-1);c=b.text();0===f.length&&"&nbsp;"!==c&&(f=$('<div class="userinput"></div>'),b.after(f));h.text(d.substring(0,d.length-1));b.text(a);return"&nbsp;"!==c?(f.prepend(c),!0):!1};this.h=function(){var b=$("#cursor"),a,c,h,f=b.prev(),d=b.next();if(0===d.length||!d.hasClass("userinput"))return!1;
h=d.text();if(0===h.length)return!1;a=h[0];c=b.text();if(0===d.length)return b.html("&nbsp;"),!1;d.text(h.substr(1));b.text(a);f.append(c);return!0};this.k=function(b){var a=$("#cursor").parent().children(".userinput").text();this.d[this.e]=a.substr(0,a.length-1);b=this.e+b;b<this.d.length&&0<=b&&(this.e=b,b=$("#cursor"),b.next().text(""),b.html("&nbsp;"),b.prev().text(this.d[this.e]))};this.v=function(b){var a;if(37===b.which)this.l();else if(39===b.which)this.h();else if(38===b.which)this.k(-1);
else if(40===b.which)this.k(1);else if(35===b.which)for(;this.h(););else if(36===b.which)for(;this.l(););else if(!b.ctrlKey||b.metaKey||b.shiftKey||67!==b.which)if(46===b.which)if(a=$("#cursor"),b=a.next(),0!==b.length&&b.hasClass("userinput")){var c=b.text();0!==c.length?(a.text(c.substr(0,1)),b.text(c.substr(1))):a.html("&nbsp;")}else a.html("&nbsp;");else 8===b.which?(b.preventDefault(),a=$("#cursor").prev(),0<a.length&&a.hasClass("userinput")&&a.text(a.text().slice(0,-1))):13===b.which?(a=$("#cursor").parent().children(".userinput").text(),
a=a.substr(0,a.length-1),0<a.length&&(this.d[this.d.length]=a,this.e=this.d.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.g.execute($.trim(a),this).progress($.proxy(this.r,this)).always($.proxy(this.i,this))):222===b.which&&b.shiftKey?(b.preventDefault(),a=$("#cursor").prev(),a.append('"'),this.h()):222===b.which?(b.preventDefault(),a=$("#cursor").prev(),a.append("'"),this.h()):(a=$("#cursor").prev(),(b=b.s())&&a.append(b));else b.preventDefault(),
$("#cursor").next().append("^C"),this.i();$(window).scrollTop($(document).height())};this.bind=function(b){this.g=b;$.proxy(this.g.p,this.g)(this);this.i()};$(window.document).keydown($.proxy(this.v,this));window.setInterval(this.blink,500)};function n(b){this.b={"?":"0"};this.A=/[\w\?\-\!]+/i;this.a=b;this.p=function(a){var c=(new p).c("GET","/users/"+this.a,{},{},!1).responseJSON.homedir;this.b.HOME=c;this.b.PWD=c;a.prompt=this.a+"@ubuntu "+c+" $ "};this.execute=function(a,c){var h=$.Deferred(),b=this.w(this.splitText(a));setTimeout($.proxy(function(){this.j(b,c,h)},this),0);return h.promise()};this.j=function(a,c,b){if("undefined"!==typeof n.commands[a[0]]){var f=[new q,new q,new q];f[1].flush=function(a){b.notify([a])};f[2].flush=
function(a){b.notify([a])};this.b["?"]=n.commands[a[0]](f,a.length,a,this.b).toString()}else void 0!==a[0]&&""!==a[0]&&(b.notify(["error: unknown command "+a[0]]),this.b["?"]="127");this.b.B=a[a.length-1];c.prompt=this.a+"@ubuntu "+this.b.PWD+" $ ";b.resolve()};this.w=function(a){for(var c=1;c<a.length;++c)for(var b=a[c].indexOf("$");0<=b;b=a[c].indexOf("$",b+1))if(0!==b&&"\\"===a[c][b-1])a[c]=a[c].substr(0,b-1)+a[c].substr(b);else{var f=this.A.exec(a[c].substr(b+1))[0];null!==f&&("undefined"===typeof this.b[f]&&
(this.b[f]=""),a[c]=a[c].substr(0,b)+this.b[f]+a[c].substr(b+f.length+1))}return a};this.splitText=function(a){for(var c="",b=[],f=!1,d=!1,e=!1,g=0;g<a.length;g++)" "===a[g]&&(f||d)?c+=a[g]:" "!==a[g]||f||d?"\\"===a[g]?e||f?(c+="\\",e=!1):e=!0:"'"===a[g]?e?(c+="'",e=!1):d?c+="'":f=!f:'"'===a[g]?e?(c+='"',e=!1):f?c+='"':d=!d:"$"===a[g]&&f?c+="\\$":(c+=a[g],e=!1):0<c.length&&(b.push(c),c="");c=$.trim(c);""!==c&&b.push(c);return b}}n.commands={};window.WebBash=n;window.WebBashLogin=function(){this.q=new p;this.a="";this.p=function(b){b.prompt="Username: "};this.execute=function(b,a){var c=$.Deferred();setTimeout($.proxy(function(){this.j(b,a,c)},this),0);return c.promise()};this.j=function(b,a,c){""===this.a?(this.a=b,""!==b&&(a.prompt="Password: "),c.resolve()):this.q.t(this.a,b).done($.proxy(function(){a.bind(new n(this.a))},this)).fail($.proxy(function(b){c.notify(b.responseText);this.a="";a.prompt="Username: ";c.resolve()},this))}};function q(){this.f=0;this.buffer="";this.write=function(b){this.buffer+=b;this.flush(this.buffer)};this.D=function(b){if(this.f>=this.buffer.length)return!1;if(void 0===b)return this.f=this.buffer.length,this.C;var a=this.buffer.substr(this.f,b);this.f+=b;return a};this.flush=function(){}};function p(){this.m=this.a="";this.t=function(b,a){this.a=b;this.m=a;return this.c("GET","/login").then($.proxy(function(a){return this.c("POST","/login",{username:this.a,password:this.m,token:a.token})},this))};this.c=function(b,a,c,h,f){return $.ajax({async:void 0===f?!0:f,data:c,dataType:"json",headers:h,type:b,url:"api.php"+a})}};(function(b,a){a.commands["false"]=m(1);a.commands["true"]=m(0);a.commands.echo=function(a,b,f){f.shift();a[1].write(f.join(" "));return 0};a.commands["export"]=function(a,b,f,d){for(a=1;a<b;++a){var e=f[a].split("=",2);d[e[0]]=e[1]}return 0};a.commands.unset=function(a,b,f,d){for(a=1;a<b;++a)d[f[a]]="";return 0};a.commands.pwd=function(a,b,f,d){a[1].write(d.PWD);return 0};a.commands.help=function(a){a[2].write("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].write("To see a full list of commands, type 'commands' ");return 0};a.commands.commands=function(b){var h=[],f;for(f in a.commands)a.commands.hasOwnProperty(f)&&h.push(f);b[1].write(h.join("\n"));return 0};a.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var f=new Date,d=Array(7);d[0]="Sun";d[1]="Mon";d[2]="Tue";d[3]="Wed";d[4]="Thu";d[5]="Fri";d[6]="Sat";var e=Array(12);e[0]="Jan";e[1]="Feb";e[2]="Mar";e[3]="Apr";e[4]="May";e[5]="Jun";e[6]="Jul";e[7]="Aug";
e[8]="Sep";e[9]="Oct";e[10]="Nov";e[11]="Dec";var g="UTC";4===f.getTimezoneOffset()/60&&(g="EDT");var d=d[f.getDay()].toString()+" "+e[f.getMonth()].toString()+" "+f.getDate().toString()+" ",k=f.getHours(),e=k.toString();10>k&&(e="0"+k.toString());var l=f.getMinutes(),k=l.toString();10>l&&(k="0"+l.toString());var l=f.getSeconds(),r=l.toString();10>l&&(r="0"+l.toString());d+=e+":"+k+":"+r+" "+g+" "+f.getFullYear().toString()+" ";a[1].write(d);return 0}})(jQuery,n);(function(b,a){var c=new p;a.commands.cd=function(a,f,d,e){var g="",g=1>=f?e.HOME:"/"===d[1][0]?b.n(d[1]):b.n(e.PWD+"/"+d[1]);f=c.c("GET","/files"+g,{},{},!1);if(200===f.status)return e.PWD=g,0;404===f.status?a[2].write("cd: "+g+": No such file or directory"):403===f.status?a[2].write("cd: "+g+": Permission denied"):a[2].write("cd: "+g+": An internal error occurred");return 1};a.commands.ls=function(a,f,d,e){var g=[],k=[];f=/-[\w]+/;for(var l in d)f.test(d[l])?g[g.length]=d[l]:k[k.length]=d[l];f=
k.length;b.u(g);1===f&&(k[f]=e.PWD,f++);for(d=1;d<f;d++)for(e=c.c("GET","/files"+k[1],{},{},!1),g=0;g<e.responseJSON.length;g++)console.log(e.responseJSON),a[1].write(e.responseJSON[g]+"\n");return 0};a.commands.ln=function(a,b,d){3!==b&&a[2].write("ln: invalid number of parameters");b=c.c("PUT","/files"+d[2],"",{"File-Type":"link","Content-Location":d[1]},!1);return 404===b.status?(a[2].write("ln: failed to create symbolic link "+d[2]+": No such file or directory"),1):403===b.status?(a[2].write("ln: failed to create symbolic link "+
d[2]+": Permission denied"),1):400<=b.status?(a[2].write("ln: failed to create symbolic link "+d[2]+": An internal error occurred"),1):0};a.commands.touch=function(a,b,d){for(var e=1;e<b;e++){var g=c.c("POST","/files"+d[e],"",{},!1);if(404===g.status)return a[2].write("touch: cannot touch "+d[e]+": No such file or directory"),1;if(403===g.status)return a[2].write("touch: cannot touch "+d[e]+": Permission denied"),1;if(400<=g.status)return a[2].write("touch: cannot touch "+d[e]+": An internal error occurred"),
1}return 0};a.commands.mkdir=function(a,b,d){for(var e=1;e<b;e++){var g=c.c("PUT","/files"+d[e],"",{"File-Type":"directory"},!1);if(404===g.status)return a[2].write("mkdir: cannot create directory "+d[e]+": No such file or directory"),1;if(403===g.status)return a[2].write("mkdir: cannot create directory "+d[e]+": Permission denied"),1;if(400<=g.status)return a[2].write("mkdir: cannot create directory "+d[e]+": An internal error occurred"),1}return 0};a.commands.cp=m(0);a.commands.mv=m(0);a.commands.rm=
m(0);a.commands.chmod=m(0);a.commands.chgrp=function(a,b,d){if(3>b)return a[2].write("chown: needs at least 2 parameters"),1;for(var e=2;e<b;e++){var g=c.c("PATCH","/files"+d[e],"",{"File-Group":d[1]},!1);if(404===g.status)a[2].write("chown: cannot access "+d[e]+": No such file or directory");else if(403===g.status)a[2].write("chown: changing ownership of "+d[e]+": Permission denied");else if(400<=g.status&&"Invalid group"===g.responseJSON)return a[2].write("chown: invalid group: "+d[1]),1}return 0};
a.commands.chown=function(a,b,d){if(3>b)return a[2].write("chown: needs at least 2 parameters"),1;for(var e=2;e<b;e++){var g=c.c("PATCH","/files"+d[e],"",{"File-Owner":d[1]},!1);if(404===g.status)a[2].write("chown: cannot access "+d[e]+": No such file or directory");else if(403===g.status)a[2].write("chown: changing ownership of "+d[e]+": Permission denied");else if(400<=g.status&&"Invalid owner"===g.responseJSON)return a[2].write("chown: invalid user: "+d[1]),1}return 0}})(jQuery,n);
