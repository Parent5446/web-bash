function m(b){return function(){return b}}
(function(b){b.Event.prototype.s=function(){var a={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},c={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},g=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(g))return!1;"undefined"!==typeof c[g]&&(g=c[g]);c=String.fromCharCode(g);
this.shiftKey?"undefined"!==typeof a[c]&&(c=a[c]):c=c.toLowerCase();return c}})(jQuery);(function(b){b.c=function(a,c,g){var d=a[0];"~"===d?a=g+"/"+a:"/"!==d&&(a=c+"/"+a);a=a.substr(1).split("/");c=[];for(g=0;g<a.length;g++)"."!==a[g]&&""!==a[g]&&(".."===a[g]?c.pop():c.push(a[g]));return"/"+c.join("/")}})(jQuery);(function(b){function a(a,g,d){return d.indexOf(a)===g}b.u=function(c){var g=[],d;for(d in c)if(c.hasOwnProperty(d))for(var b=1;b<c[d].length;++b)g[g.length]=c[d][b];g.filter(a)}})(jQuery);window.Terminal=function(){this.h=null;this.prompt="root@ubuntu> ";this.e=[];this.f=0;this.o=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'));$(window).scrollTop($(document).height())};this.j=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.o()};this.r=function(b){var a=$('<div class="system_output"></div>');
a.text(b);$("body > ul > li:last-child").append(a);this.o()};this.blink=function(){$("#cursor").toggleClass("blink")};this.m=function(){var b=$("#cursor"),a,c,g=b.prev(),d=b.next();if(0===g.length||!g.hasClass("userinput"))return!1;var e=g.text();if(0===e.length)return!1;a=e.substr(e.length-1);c=b.text();0===d.length&&"&nbsp;"!==c&&(d=$('<div class="userinput"></div>'),b.after(d));g.text(e.substring(0,e.length-1));b.text(a);return"&nbsp;"!==c?(d.prepend(c),!0):!1};this.i=function(){var b=$("#cursor"),
a,c,g,d=b.prev(),e=b.next();if(0===e.length||!e.hasClass("userinput"))return!1;g=e.text();if(0===g.length)return!1;a=g[0];c=b.text();if(0===e.length)return b.html("&nbsp;"),!1;e.text(g.substr(1));b.text(a);d.append(c);return!0};this.l=function(b){var a=$("#cursor").parent().children(".userinput").text();this.e[this.f]=a.substr(0,a.length-1);b=this.f+b;b<this.e.length&&0<=b&&(this.f=b,b=$("#cursor"),b.next().text(""),b.html("&nbsp;"),b.prev().text(this.e[this.f]))};this.v=function(b){var a;if(37===
b.which)this.m();else if(39===b.which)this.i();else if(38===b.which)this.l(-1);else if(40===b.which)this.l(1);else if(35===b.which)for(;this.i(););else if(36===b.which)for(;this.m(););else if(!b.ctrlKey||b.metaKey||b.shiftKey||67!==b.which)if(46===b.which)if(a=$("#cursor"),b=a.next(),0!==b.length&&b.hasClass("userinput")){var c=b.text();0!==c.length?(a.text(c.substr(0,1)),b.text(c.substr(1))):a.html("&nbsp;")}else a.html("&nbsp;");else 8===b.which?(b.preventDefault(),a=$("#cursor").prev(),0<a.length&&
a.hasClass("userinput")&&a.text(a.text().slice(0,-1))):13===b.which?(a=$("#cursor").parent().children(".userinput").text(),a=a.substr(0,a.length-1),0<a.length&&(this.e[this.e.length]=a,this.f=this.e.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.h.execute($.trim(a),this).progress($.proxy(this.r,this)).always($.proxy(this.j,this))):222===b.which&&b.shiftKey?(b.preventDefault(),a=$("#cursor").prev(),a.append('"'),this.i()):222===b.which?(b.preventDefault(),
a=$("#cursor").prev(),a.append("'"),this.i()):(a=$("#cursor").prev(),(b=b.s())&&a.append(b));else b.preventDefault(),$("#cursor").next().append("^C"),this.j();$(window).scrollTop($(document).height())};this.bind=function(b){this.h=b;$.proxy(this.h.p,this.h)(this);this.j()};$(window.document).keydown($.proxy(this.v,this));window.setInterval(this.blink,500)};function n(b){this.d={"?":"0"};this.A=/[\w\?\-\!]+/i;this.b=b;this.p=function(a){var c=(new p).a("GET","/users/"+this.b,{},{},!1).responseJSON.homedir;this.d.HOME=c;this.d.PWD=c;a.prompt=this.b+"@ubuntu "+c+" $ "};this.execute=function(a,c){var g=$.Deferred(),b=this.w(this.splitText(a));setTimeout($.proxy(function(){this.k(b,c,g)},this),0);return g.promise()};this.k=function(a,c,g){if("undefined"!==typeof n.commands[a[0]]){var b=[new q,new q,new q];b[1].flush=function(a){g.notify([a])};b[2].flush=
function(a){g.notify([a])};this.d["?"]=n.commands[a[0]](b,a.length,a,this.d).toString()}else void 0!==a[0]&&""!==a[0]&&(g.notify(["error: unknown command "+a[0]]),this.d["?"]="127");this.d.B=a[a.length-1];c.prompt=this.b+"@ubuntu "+this.d.PWD+" $ ";g.resolve()};this.w=function(a){for(var c=1;c<a.length;++c)for(var g=a[c].indexOf("$");0<=g;g=a[c].indexOf("$",g+1))if(0!==g&&"\\"===a[c][g-1])a[c]=a[c].substr(0,g-1)+a[c].substr(g);else{var b=this.A.exec(a[c].substr(g+1))[0];null!==b&&("undefined"===typeof this.d[b]&&
(this.d[b]=""),a[c]=a[c].substr(0,g)+this.d[b]+a[c].substr(g+b.length+1))}return a};this.splitText=function(a){for(var c="",b=[],d=!1,e=!1,f=!1,h=0;h<a.length;h++)" "===a[h]&&(d||e)?c+=a[h]:" "!==a[h]||d||e?"\\"===a[h]?f||d?(c+="\\",f=!1):f=!0:"'"===a[h]?f?(c+="'",f=!1):e?c+="'":d=!d:'"'===a[h]?f?(c+='"',f=!1):d?c+='"':e=!e:"$"===a[h]&&d?c+="\\$":(c+=a[h],f=!1):0<c.length&&(b.push(c),c="");c=$.trim(c);""!==c&&b.push(c);return b}}n.commands={};window.WebBash=n;window.WebBashLogin=function(){this.q=new p;this.b="";this.p=function(b){b.prompt="Username: "};this.execute=function(b,a){var c=$.Deferred();setTimeout($.proxy(function(){this.k(b,a,c)},this),0);return c.promise()};this.k=function(b,a,c){""===this.b?(this.b=b,""!==b&&(a.prompt="Password: "),c.resolve()):this.q.t(this.b,b).done($.proxy(function(){a.bind(new n(this.b))},this)).fail($.proxy(function(b){c.notify(b.responseText);this.b="";a.prompt="Username: ";c.resolve()},this))}};function q(){this.g=0;this.buffer="";this.write=function(b){this.buffer+=b;this.flush(this.buffer)};this.D=function(b){if(this.g>=this.buffer.length)return!1;if(void 0===b)return this.g=this.buffer.length,this.C;var a=this.buffer.substr(this.g,b);this.g+=b;return a};this.flush=function(){}};function p(){this.n=this.b="";this.t=function(b,a){this.b=b;this.n=a;return this.a("GET","/login").then($.proxy(function(a){return this.a("POST","/login",{username:this.b,password:this.n,token:a.token})},this))};this.a=function(b,a,c,g,d){var e="application/x-www-form-urlencoded";void 0!==g&&"Content-Type"in g&&(e=g["Content-Type"]);return $.ajax({async:void 0===d?!0:d,contentType:e,data:c,headers:g,type:b,url:"api.php"+a})}};(function(b,a){a.commands["false"]=m(1);a.commands["true"]=m(0);a.commands.echo=function(a,b,d){d.shift();a[1].write(d.join(" "));return 0};a.commands["export"]=function(a,b,d,e){for(a=1;a<b;++a){var f=d[a].split("=",2);e[f[0]]=f[1]}return 0};a.commands.unset=function(a,b,d,e){for(a=1;a<b;++a)e[d[a]]="";return 0};a.commands.pwd=function(a,b,d,e){a[1].write(e.PWD);return 0};a.commands.help=function(a){a[2].write("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].write("To see a full list of commands, type 'commands' ");return 0};a.commands.commands=function(b){var g=[],d;for(d in a.commands)a.commands.hasOwnProperty(d)&&g.push(d);b[1].write(g.join("\n"));return 0};a.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var d=new Date,e=Array(7);e[0]="Sun";e[1]="Mon";e[2]="Tue";e[3]="Wed";e[4]="Thu";e[5]="Fri";e[6]="Sat";var f=Array(12);f[0]="Jan";f[1]="Feb";f[2]="Mar";f[3]="Apr";f[4]="May";f[5]="Jun";f[6]="Jul";f[7]="Aug";
f[8]="Sep";f[9]="Oct";f[10]="Nov";f[11]="Dec";var h="UTC";4===d.getTimezoneOffset()/60&&(h="EDT");var e=e[d.getDay()].toString()+" "+f[d.getMonth()].toString()+" "+d.getDate().toString()+" ",k=d.getHours(),f=k.toString();10>k&&(f="0"+k.toString());var l=d.getMinutes(),k=l.toString();10>l&&(k="0"+l.toString());var l=d.getSeconds(),r=l.toString();10>l&&(r="0"+l.toString());e+=f+":"+k+":"+r+" "+h+" "+d.getFullYear().toString()+" ";a[1].write(e);return 0}})(jQuery,n);(function(b,a){var c=new p;a.commands.cd=function(a,d,e,f){var h="",h=1>=d?f.HOME:b.c(e[1],f.PWD,f.HOME);d=c.a("GET","/files"+h,{},{},!1);if(200===d.status)return f.PWD=h,0;404===d.status?a[2].write("cd: "+h+": No such file or directory"):403===d.status?a[2].write("cd: "+h+": Permission denied"):a[2].write("cd: "+h+": An internal error occurred");return 1};a.commands.ls=function(a,d,e,f){var h=[],k=[];d=/-[\w]+/;for(var l in e)d.test(e[l])?h[h.length]=e[l]:k[k.length]=e[l];d=k.length;b.u(h);1===d&&
(k[d]=f.PWD,d++);for(e=1;e<d;e++)for(f=c.a("GET","/files"+k[1],{},{},!1),h=0;h<f.responseJSON.length;h++)console.log(f.responseJSON),a[1].write(f.responseJSON[h]+"\n");return 0};a.commands.ln=function(a,d,e,f){3!==d&&a[2].write("ln: invalid number of parameters");d=b.c(e[1],f.PWD,f.HOME);e=b.c(e[2],f.PWD,f.HOME);f=c.a("PUT","/files"+e,"",{"File-Type":"link","Content-Location":d},!1);return 404===f.status?(a[2].write("ln: failed to create symbolic link "+e+": No such file or directory"),1):403===f.status?
(a[2].write("ln: failed to create symbolic link "+e+": Permission denied"),1):400<=f.status?(a[2].write("ln: failed to create symbolic link "+e+": An internal error occurred"),1):0};a.commands.touch=function(a,d,e,f){for(var h=1;h<d;h++){var k=b.c(e[h],f.PWD,f.HOME),l=c.a("POST","/files"+k,"",{},!1);if(404===l.status)return a[2].write("touch: cannot touch "+k+": No such file or directory"),1;if(403===l.status)return a[2].write("touch: cannot touch "+k+": Permission denied"),1;if(400<=l.status)return a[2].write("touch: cannot touch "+
k+": An internal error occurred"),1}return 0};a.commands.mkdir=function(a,d,e,f){for(var h=1;h<d;h++){var k=b.c(e[h],f.PWD,f.HOME),l=c.a("PUT","/files"+k,"",{"File-Type":"directory"},!1);if(404===l.status)return a[2].write("mkdir: cannot create directory "+k+": No such file or directory"),1;if(403===l.status)return a[2].write("mkdir: cannot create directory "+k+": Permission denied"),1;if(400<=l.status)return a[2].write("mkdir: cannot create directory "+k+": An internal error occurred"),1}return 0};
a.commands.cp=function(a,d,e,f){3!==d&&a[2].write("cp: invalid number of parameters");d=b.c(e[1],f.PWD,f.HOME);e=b.c(e[2],f.PWD,f.HOME);f=c.a("PUT","/files"+e,d,{"Content-Type":"application/vnd.webbash.filepath"},!1);return 404===f.status?(a[2].write("cp: cannot create regular file "+e+": No such file or directory"),1):403===f.status?(a[2].write("cp: cannot create regular file "+e+": Permission denied"),1):400<=f.status&&"Invalid file data source"===f.responseJSON?(a[2].write("cp: cannot stat "+d+
": No such file or directory"),1):0};a.commands.mv=function(a,d,e,f){3!==d&&a[2].write("mv: invalid number of parameters");d=b.c(e[1],f.PWD,f.HOME);e=b.c(e[2],f.PWD,f.HOME);f=c.a("PUT","/files"+e,d,{"Content-Type":"application/vnd.webbash.filepath"},!1);if(404===f.status)return a[2].write("mv: cannot create regular file "+e+": No such file or directory"),1;if(403===f.status)return a[2].write("mv: cannot create regular file "+e+": Permission denied"),1;if(400<=f.status&&"Invalid file data source"===
f.responseJSON)return a[2].write("mv: cannot stat "+d+": No such file or directory"),1;f=c.a("DELETE","/files"+d,"",{},!1);return 403===f.status?(a[2].write("mv: cannot remove "+d+": Permission denied"),1):0};a.commands.rm=m(0);a.commands.chmod=m(0);a.commands.chgrp=function(a,d,e,f){if(3>d)return a[2].write("chown: needs at least 2 parameters"),1;for(var h=2;h<d;h++){var k=b.c(e[h],f.PWD,f.HOME),l=c.a("PATCH","/files"+k,"",{"File-Group":e[1]},!1);if(404===l.status)a[2].write("chown: cannot access "+
k+": No such file or directory");else if(403===l.status)a[2].write("chown: changing ownership of "+k+": Permission denied");else if(400<=l.status&&"Invalid group"===l.responseJSON)return a[2].write("chown: invalid group: "+e[1]),1}return 0};a.commands.chown=function(a,d,e,f){if(3>d)return a[2].write("chown: needs at least 2 parameters"),1;for(var h=2;h<d;h++){var k=b.c(e[h],f.PWD,f.HOME),l=c.a("PATCH","/files"+k,"",{"File-Owner":e[1]},!1);if(404===l.status)a[2].write("chown: cannot access "+k+": No such file or directory");
else if(403===l.status)a[2].write("chown: changing ownership of "+k+": Permission denied");else if(400<=l.status&&"Invalid owner"===l.responseJSON)return a[2].write("chown: invalid user: "+e[1]),1}return 0}})(jQuery,n);
