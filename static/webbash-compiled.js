function m(a){return function(){return a}}
(function(a){a.Event.prototype.s=function(){var b={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},e={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},a=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(a))return!1;"undefined"!==typeof e[a]&&(a=e[a]);e=String.fromCharCode(a);
this.shiftKey?"undefined"!==typeof b[e]&&(e=b[e]):e=e.toLowerCase();return e}})(jQuery);(function(a){a.n=function(b){b=b.substr(1).split("/");for(var e=[],a=0;a<b.length;a++)"."!==b[a]&&""!==b[a]&&(".."===b[a]?e.pop():e.push(b[a]));return"/"+e.join("/")}})(jQuery);(function(a){function b(b,a,c){return c.indexOf(b)===a}a.u=function(e){var a=[],c;for(c in e)if(e.hasOwnProperty(c))for(var d=1;d<e[c].length;++d)a[a.length]=e[c][d];a.filter(b)}})(jQuery);window.Terminal=function(){this.g=null;this.prompt="root@ubuntu> ";this.c=[];this.e=0;this.o=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'))};this.clear=function(){$("body > ul").empty()};this.i=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.o()};this.r=function(a){var b=$('<div class="system_output"></div>');
b.text(a);$("body > ul > li:last-child").append(b);this.o()};this.blink=function(){$("#cursor").toggleClass("blink")};this.l=function(){var a=$("#cursor"),b,e,h=a.prev(),c=a.next();if(0===h.length||!h.hasClass("userinput"))return!1;var d=h.text();if(0===d.length)return!1;b=d.substr(d.length-1);e=a.text();0===c.length&&"&nbsp;"!==e&&(c=$('<div class="userinput"></div>'),a.after(c));h.text(d.substring(0,d.length-1));a.text(b);return"&nbsp;"!==e?(c.prepend(e),!0):!1};this.h=function(){var a=$("#cursor"),
b,e,h,c=a.prev(),d=a.next();if(0===d.length||!d.hasClass("userinput"))return!1;h=d.text();if(0===h.length)return!1;b=h[0];e=a.text();if(0===d.length)return a.html("&nbsp;"),!1;d.text(h.substr(1));a.text(b);c.append(e);return!0};this.k=function(a){var b=$("#cursor").parent().children(".userinput").text();this.c[this.e]=b.substr(0,b.length-1);a=this.e+a;a<this.c.length&&0<=a&&(this.e=a,a=$("#cursor"),a.next().text(""),a.html("&nbsp;"),a.prev().text(this.c[this.e]))};this.v=function(a){var b;if(37===
a.which)this.l();else if(39===a.which)this.h();else if(38===a.which)this.k(-1);else if(40===a.which)this.k(1);else if(35===a.which)for(;this.h(););else if(36===a.which)for(;this.l(););else if(!a.ctrlKey||a.metaKey||a.shiftKey||67!==a.which)if(46===a.which)if(b=$("#cursor"),a=b.next(),0!==a.length&&a.hasClass("userinput")){var e=a.text();0!==e.length?(b.text(e.substr(0,1)),a.text(e.substr(1))):b.html("&nbsp;")}else b.html("&nbsp;");else 8===a.which?(a.preventDefault(),b=$("#cursor").prev(),0<b.length&&
b.hasClass("userinput")&&b.text(b.text().slice(0,-1))):13===a.which?(b=$("#cursor").parent().children(".userinput").text(),b=b.substr(0,b.length-1),0<b.length&&(this.c[this.c.length]=b,this.e=this.c.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.g.execute($.trim(b),this).progress($.proxy(this.r,this)).always($.proxy(this.i,this))):222===a.which&&a.shiftKey?(a.preventDefault(),b=$("#cursor").prev(),b.append('"'),this.h()):222===a.which?(a.preventDefault(),
b=$("#cursor").prev(),b.append("'"),this.h()):(b=$("#cursor").prev(),(a=a.s())&&b.append(a));else a.preventDefault(),$("#cursor").next().append("^C"),this.i();$(window).scrollTop($(document).height())};this.bind=function(a){this.g=a;$.proxy(this.g.p,this.g)(this);this.i()};$(window.document).keydown($.proxy(this.v,this));window.setInterval(this.blink,500)};function n(a){this.b={"?":"0"};this.A=/[\w\?\-\!]+/i;this.a=a;this.p=function(b){var e=(new p).d("GET","/users/"+this.a,{},{},!1).responseJSON.homedir;this.b.HOME=e;this.b.PWD=e;b.prompt=this.a+"@ubuntu "+e+" $ "};this.execute=function(b,e){var a=$.Deferred(),c=this.w(this.splitText(b));setTimeout($.proxy(function(){this.j(c,e,a)},this),0);return a.promise()};this.j=function(b,e,a){if("clear"===b[0])e.clear();else if("undefined"!==typeof n.commands[b[0]]){var c=[new q,new q,new q];c[1].flush=function(b){a.notify([b])};
c[2].flush=function(b){a.notify([b])};this.b["?"]=n.commands[b[0]](c,b.length,b,this.b).toString()}else void 0!==b[0]&&""!==b[0]&&(a.notify(["error: unknown command "+b[0]]),this.b["?"]="127");this.b.B=b[b.length-1];e.prompt=this.a+"@ubuntu "+this.b.PWD+" $ ";a.resolve()};this.w=function(b){for(var a=1;a<b.length;++a)for(var h=b[a].indexOf("$");0<=h;h=b[a].indexOf("$",h+1))if(0!==h&&"\\"===b[a][h-1])b[a]=b[a].substr(0,h-1)+b[a].substr(h);else{var c=this.A.exec(b[a].substr(h+1))[0];null!==c&&("undefined"===
typeof this.b[c]&&(this.b[c]=""),b[a]=b[a].substr(0,h)+this.b[c]+b[a].substr(h+c.length+1))}return b};this.splitText=function(b){for(var a="",h=[],c=!1,d=!1,f=!1,g=0;g<b.length;g++)" "===b[g]&&(c||d)?a+=b[g]:" "!==b[g]||c||d?"\\"===b[g]?f||c?(a+="\\",f=!1):f=!0:"'"===b[g]?f?(a+="'",f=!1):d?a+="'":c=!c:'"'===b[g]?f?(a+='"',f=!1):c?a+='"':d=!d:"$"===b[g]&&c?a+="\\$":(a+=b[g],f=!1):0<a.length&&(h.push(a),a="");a=$.trim(a);""!==a&&h.push(a);return h}}n.commands={};window.WebBash=n;window.WebBashLogin=function(){this.q=new p;this.a="";this.p=function(a){a.prompt="Username: "};this.execute=function(a,b){var e=$.Deferred();setTimeout($.proxy(function(){this.j(a,b,e)},this),0);return e.promise()};this.j=function(a,b,e){""===this.a?(this.a=a,""!==a&&(b.prompt="Password: "),e.resolve()):this.q.t(this.a,a).done($.proxy(function(){b.bind(new n(this.a))},this)).fail(function(a){e.notify(a.responseText);this.a=null;b.prompt="Username: ";e.resolve()})}};function q(){this.f=0;this.buffer="";this.write=function(a){this.buffer+=a;this.flush(this.buffer)};this.D=function(a){if(this.f>=this.buffer.length)return!1;if(void 0===a)return this.f=this.buffer.length,this.C;var b=this.buffer.substr(this.f,a);this.f+=a;return b};this.flush=function(){}};function p(){this.m=this.a="";this.t=function(a,b){this.a=a;this.m=b;return this.d("GET","/login").then($.proxy(function(a){return this.d("POST","/login",{username:this.a,password:this.m,token:a.token})},this))};this.d=function(a,b,e,h,c){return $.ajax({async:void 0===c?!0:c,data:e,dataType:"json",headers:h,type:a,url:"api.php"+b})}};(function(a,b){b.commands["false"]=m(1);b.commands["true"]=m(0);b.commands.echo=function(a,b,c){c.shift();a[1].write(c.join(" "));return 0};b.commands["export"]=function(a,b,c,d){for(a=1;a<b;++a){var f=c[a].split("=",2);d[f[0]]=f[1]}return 0};b.commands.unset=function(a,b,c,d){for(a=1;a<b;++a)d[c[a]]="";return 0};b.commands.pwd=function(a,b,c,d){a[1].write(d.PWD);return 0};b.commands.help=function(a){a[2].write("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].write("To see a full list of commands, type 'commands' ");return 0};b.commands.commands=function(a){var h=[],c;for(c in b.commands)b.commands.hasOwnProperty(c)&&h.push(c);a[1].write(h.join("\n"));return 0};b.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var c=new Date,d=Array(7);d[0]="Sun";d[1]="Mon";d[2]="Tue";d[3]="Wed";d[4]="Thu";d[5]="Fri";d[6]="Sat";var f=Array(12);f[0]="Jan";f[1]="Feb";f[2]="Mar";f[3]="Apr";f[4]="May";f[5]="Jun";f[6]="Jul";f[7]="Aug";
f[8]="Sep";f[9]="Oct";f[10]="Nov";f[11]="Dec";var g="UTC";4===c.getTimezoneOffset()/60&&(g="EDT");var d=d[c.getDay()].toString()+" "+f[c.getMonth()].toString()+" "+c.getDate().toString()+" ",k=c.getHours(),f=k.toString();10>k&&(f="0"+k.toString());var l=c.getMinutes(),k=l.toString();10>l&&(k="0"+l.toString());var l=c.getSeconds(),r=l.toString();10>l&&(r="0"+l.toString());d+=f+":"+k+":"+r+" "+g+" "+c.getFullYear().toString()+" ";a[1].write(d);return 0}})(jQuery,n);(function(a,b){var e=new p;b.commands.cd=function(b,c,d,f){var g="",g=1>=c?f.PWD:"/"===d[1][0]?a.n(d[1]):a.n(f.PWD+"/"+d[1]);if(200===e.d("GET","/files"+g,{},{},!1).status)return f.PWD=g,0;b[2].write("cd: "+g+": No such file or directory");return 1};b.commands.ls=function(b,c,d,f){var g=[],k=[];c=/-[\w]+/;for(var l in d)c.test(d[l])?g[g.length]=d[l]:k[k.length]=d[l];c=k.length;a.u(g);1===c&&(k[c]=f.PWD,c++);for(d=1;d<c;d++)for(f=e.d("GET","/files"+k[1],{},{},!1),console.log(f.responseJSON),g=0;g<
f.responseJSON.length;g++)console.log(f.responseJSON),b[1].write(f.responseJSON[g]+"\n");return 0};b.commands.ln=m(0);b.commands.touch=m(0);b.commands.mkdir=function(a,b,d){for(var f=1;f<b;f++){var g=e.d("PUT","/files"+d[f],"",{"File-Type":"directory"},!1);if(404===g.status)return a[2].write("mkdir: cannot create directory "+d[f]+": No such file or directory"),1;if(403===g.status)return a[2].write("mkdir: cannot create directory "+d[f]+": Permission denied"),1;if(400<=g.status)return a[2].write("mkdir: cannot create directory "+
d[f]+": An internal error occurred"),1}return 0};b.commands.cp=m(0);b.commands.mv=m(0);b.commands.rm=m(0);b.commands.chmod=m(0);b.commands.chgrp=m(0);b.commands.chown=m(0)})(jQuery,n);
