function t(a){return function(){return a}}
(function(a){a.Event.prototype.s=function(){var b={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},c={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},a=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(a))return!1;"undefined"!==typeof c[a]&&(a=c[a]);c=String.fromCharCode(a);
this.shiftKey?"undefined"!==typeof b[c]&&(c=b[c]):c=c.toLowerCase();return c}})(jQuery);(function(a){a.b=function(b,c,a){var d=b[0];"~"===d?b=a+"/"+b:"/"!==d&&(b=c+"/"+b);b=b.substr(1).split("/");c=[];for(a=0;a<b.length;a++)"."!==b[a]&&""!==b[a]&&(".."===b[a]?c.pop():c.push(b[a]));return"/"+c.join("/")}})(jQuery);(function(a){function b(b,a,d){return d.indexOf(b)===a}a.u=function(c){var a=[],d;for(d in c)if(c.hasOwnProperty(d))for(var e=1;e<c[d].length;++e)a[a.length]=c[d][e];return a=a.filter(b)}})(jQuery);window.Terminal=function(){this.h=null;this.prompt="root@ubuntu> ";this.e=[];this.f=0;this.o=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'));$(window).scrollTop($(document).height())};this.clear=function(){$("body > ul").empty()};this.j=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.o()};this.r=
function(a){var b=$('<div class="system_output"></div>');b.text(a);$("body > ul > li:last-child").append(b);this.o()};this.blink=function(){$("#cursor").toggleClass("blink")};this.m=function(){var a=$("#cursor"),b,c,g=a.prev(),d=a.next();if(0===g.length||!g.hasClass("userinput"))return!1;var e=g.text();if(0===e.length)return!1;b=e.substr(e.length-1);c=a.text();0===d.length&&"&nbsp;"!==c&&(d=$('<div class="userinput"></div>'),a.after(d));g.text(e.substring(0,e.length-1));a.text(b);return"&nbsp;"!==
c?(d.prepend(c),!0):!1};this.i=function(){var a=$("#cursor"),b,c,g,d=a.prev(),e=a.next();if(0===e.length||!e.hasClass("userinput"))return!1;g=e.text();if(0===g.length)return!1;b=g[0];c=a.text();if(0===e.length)return a.html("&nbsp;"),!1;e.text(g.substr(1));a.text(b);d.append(c);return!0};this.l=function(a){var b=$("#cursor").parent().children(".userinput").text();this.e[this.f]=b.substr(0,b.length-1);a=this.f+a;a<this.e.length&&0<=a&&(this.f=a,a=$("#cursor"),a.next().text(""),a.html("&nbsp;"),a.prev().text(this.e[this.f]))};
this.v=function(a){var b;if(37===a.which)this.m();else if(39===a.which)this.i();else if(38===a.which)this.l(-1);else if(40===a.which)this.l(1);else if(35===a.which)for(;this.i(););else if(36===a.which)for(;this.m(););else if(!a.ctrlKey||a.metaKey||a.shiftKey||67!==a.which)if(46===a.which)if(b=$("#cursor"),a=b.next(),0!==a.length&&a.hasClass("userinput")){var c=a.text();0!==c.length?(b.text(c.substr(0,1)),a.text(c.substr(1))):b.html("&nbsp;")}else b.html("&nbsp;");else 8===a.which?(a.preventDefault(),
b=$("#cursor").prev(),0<b.length&&b.hasClass("userinput")&&b.text(b.text().slice(0,-1))):13===a.which?(b=$("#cursor").parent().children(".userinput").text(),b=b.substr(0,b.length-1),0<b.length&&(this.e[this.e.length]=b,this.f=this.e.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.h.execute($.trim(b),this).progress($.proxy(this.r,this)).always($.proxy(this.j,this))):222===a.which&&a.shiftKey?(a.preventDefault(),b=$("#cursor").prev(),b.append('"'),
this.i()):222===a.which?(a.preventDefault(),b=$("#cursor").prev(),b.append("'"),this.i()):(b=$("#cursor").prev(),(a=a.s())&&b.append(a));else a.preventDefault(),$("#cursor").next().append("^C"),this.j();$(window).scrollTop($(document).height())};this.bind=function(a){this.h=a;$.proxy(this.h.p,this.h)(this);this.j()};$(window.document).keydown($.proxy(this.v,this));window.setInterval(this.blink,500)};function v(a){this.d={"?":"0"};this.A=/[\w\?\-\!]+/i;this.c=a;this.p=function(b){var a=(new x).a("GET","/users/"+this.c,{},{},!1).responseJSON.homedir;this.d.HOME=a;this.d.PWD=a;b.prompt=this.c+"@ubuntu "+a+" $ "};this.execute=function(b,a){var g=$.Deferred(),d=this.w(this.splitText(b));setTimeout($.proxy(function(){this.k(d,a,g)},this),0);return g.promise()};this.k=function(b,a,g){if("clear"===b[0])a.clear();else if("undefined"!==typeof v.commands[b[0]]){var d=[new y,new y,new y];d[1].flush=function(b){g.notify([b])};
d[2].flush=function(b){g.notify([b])};this.d["?"]=v.commands[b[0]](d,b.length,b,this.d).toString()}else void 0!==b[0]&&""!==b[0]&&(g.notify(["error: unknown command "+b[0]]),this.d["?"]="127");this.d.B=b[b.length-1];a.prompt=this.c+"@ubuntu "+this.d.PWD+" $ ";g.resolve()};this.w=function(b){for(var a=1;a<b.length;++a)for(var g=b[a].indexOf("$");0<=g;g=b[a].indexOf("$",g+1))if(0!==g&&"\\"===b[a][g-1])b[a]=b[a].substr(0,g-1)+b[a].substr(g);else{var d=this.A.exec(b[a].substr(g+1))[0];null!==d&&("undefined"===
typeof this.d[d]&&(this.d[d]=""),b[a]=b[a].substr(0,g)+this.d[d]+b[a].substr(g+d.length+1))}return b};this.splitText=function(a){for(var c="",g=[],d=!1,e=!1,f=!1,p=0;p<a.length;p++)" "===a[p]&&(d||e)?c+=a[p]:" "!==a[p]||d||e?"\\"===a[p]?f||d?(c+="\\",f=!1):f=!0:"'"===a[p]?f?(c+="'",f=!1):e?c+="'":d=!d:'"'===a[p]?f?(c+='"',f=!1):d?c+='"':e=!e:"$"===a[p]&&d?c+="\\$":(c+=a[p],f=!1):0<c.length&&(g.push(c),c="");c=$.trim(c);""!==c&&g.push(c);return g}}v.commands={};window.WebBash=v;window.WebBashLogin=function(){this.q=new x;this.c="";this.p=function(a){a.prompt="Username: "};this.execute=function(a,b){var c=$.Deferred();setTimeout($.proxy(function(){this.k(a,b,c)},this),0);return c.promise()};this.k=function(a,b,c){""===this.c?(this.c=a,""!==a&&(b.prompt="Password: "),c.resolve()):this.q.t(this.c,a).done($.proxy(function(){b.bind(new v(this.c))},this)).fail($.proxy(function(a){c.notify(a.responseText);this.c="";b.prompt="Username: ";c.resolve()},this))}};function y(){this.g=0;this.buffer="";this.write=function(a){this.buffer+=a;this.flush(this.buffer)};this.D=function(a){if(this.g>=this.buffer.length)return!1;if(void 0===a)return this.g=this.buffer.length,this.C;var b=this.buffer.substr(this.g,a);this.g+=a;return b};this.flush=function(){}};function x(){this.n=this.c="";this.t=function(a,b){this.c=a;this.n=b;return this.a("GET","/login").then($.proxy(function(a){return this.a("POST","/login",{username:this.c,password:this.n,token:a.token})},this))};this.a=function(a,b,c,g,d){var e="application/x-www-form-urlencoded";void 0!==g&&"Content-Type"in g&&(e=g["Content-Type"]);return $.ajax({async:void 0===d?!0:d,contentType:e,data:c,headers:g,type:a,url:"api.php"+b})}};(function(a,b){b.commands["false"]=t(1);b.commands["true"]=t(0);b.commands.echo=function(a,b,d){d.shift();a[1].write(d.join(" "));return 0};b.commands["export"]=function(a,b,d,e){for(a=1;a<b;++a){var f=d[a].split("=",2);e[f[0]]=f[1]}return 0};b.commands.unset=function(a,b,d,e){for(a=1;a<b;++a)e[d[a]]="";return 0};b.commands.pwd=function(a,b,d,e){a[1].write(e.PWD);return 0};b.commands.help=function(a){a[2].write("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. ");
a[2].write("To see a full list of commands, type 'commands' ");return 0};b.commands.commands=function(a){var g=[],d;for(d in b.commands)b.commands.hasOwnProperty(d)&&g.push(d);a[1].write(g.join("\n"));return 0};b.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var d=new Date,e=Array(7);e[0]="Sun";e[1]="Mon";e[2]="Tue";e[3]="Wed";e[4]="Thu";e[5]="Fri";e[6]="Sat";var f=Array(12);f[0]="Jan";f[1]="Feb";f[2]="Mar";f[3]="Apr";f[4]="May";f[5]="Jun";f[6]="Jul";f[7]="Aug";
f[8]="Sep";f[9]="Oct";f[10]="Nov";f[11]="Dec";var p="UTC";4===d.getTimezoneOffset()/60&&(p="EDT");var e=e[d.getDay()].toString()+" "+f[d.getMonth()].toString()+" "+d.getDate().toString()+" ",u=d.getHours(),f=u.toString();10>u&&(f="0"+u.toString());var n=d.getMinutes(),u=n.toString();10>n&&(u="0"+n.toString());var n=d.getSeconds(),h=n.toString();10>n&&(h="0"+n.toString());e+=f+":"+u+":"+h+" "+p+" "+d.getFullYear().toString()+" ";a[1].write(e);return 0}})(jQuery,v);(function(a,b){function c(a,b,c){var h=" ";"undefined"==typeof b&&(b=0);"undefined"==typeof h&&(h=" ");"undefined"==typeof c&&(c=e);if(b+1>=a.length)switch(c){case d:a=Array(b+1-a.length).join(h)+a;break;case f:b=Math.ceil((padlen=b-a.length)/2);a=Array(padlen-b+1).join(h)+a+Array(b+1).join(h);break;default:a+=Array(b+1-a.length).join(h)}return a}var g=new x;b.commands.cd=function(b,c,d,h){var e="",e=1>=c?h.HOME:"/"===d[1][0]?a.b(d[1]):a.b(d[1],h.PWD,h.HOME);c=g.a("GET","/files"+e,{},{},!1);if(200===
c.status)return h.PWD=e,0;404===c.status?b[2].write("cd: "+e+": No such file or directory"):403===c.status?b[2].write("cd: "+e+": Permission denied"):b[2].write("cd: "+e+": An internal error occurred");return 1};var d=1,e=2,f=3;b.commands.ls=function(b,e,n,h){var f=[],m=[],l=[];e=/-[\w]+/;for(var s in n)e.test(n[s])?f[f.length]=n[s]:m[m.length]=n[s];e=m.length;f=a.u(f);1===e&&(m[e]="",e++);n="/files"+h.PWD;for(h=1;h<e;h++)if(s=g.a("GET",n+m[h],{},{},!1),s.responseJSON instanceof Array)for(var z=0;z<
s.responseJSON.length;z++){var F=b[1],q=s.responseJSON[z],A=f,k=q[6]+"\t\t",w=void 0,r=!0,D=!1,B=void 0;for(B in A)if(A.hasOwnProperty(B))switch(A[B]){case "a":D=!0;break;case "l":for(var k="d"===q[0]?"d":"-",r=256,E=0;3>E;E++)k=r&q[1]?k+"r":k+"-",r>>=1,k=r&q[1]?k+"w":k+"-",r>>=1,k=r&q[1]?k+"x":k+"-";k+=" "+c(q[2],10,d);k+=" "+c(q[3],6,d);k+=" "+c(q[4].toString(),6,d);k+=" "+q[5].date;k+=" "+q[6];r=!1}"undefined"===typeof w?w=0:w++;r?w%4&&(k+="\n"):k+="\n";("."!==name[0]&&".."!==name||D)&&F.write(k)}else"string"===
typeof s.responseJSOn&&(l[l.length]=m[h]);for(var C in l)C.hasOwnProperty(C)&&b[1].write("Failed to find the following path "+l[C]+"\n");return 0};b.commands.ln=function(b,c,d,h){3!==c&&b[2].write("ln: invalid number of parameters");c=a.b(d[1],h.PWD,h.HOME);d=a.b(d[2],h.PWD,h.HOME);h=g.a("PUT","/files"+d,"",{"File-Type":"link","Content-Location":c},!1);return 404===h.status?(b[2].write("ln: failed to create symbolic link "+d+": No such file or directory"),1):403===h.status?(b[2].write("ln: failed to create symbolic link "+
d+": Permission denied"),1):400<=h.status?(b[2].write("ln: failed to create symbolic link "+d+": An internal error occurred"),1):0};b.commands.touch=function(b,c,d,h){for(var e=1;e<c;e++){var f=a.b(d[e],h.PWD,h.HOME),l=g.a("POST","/files"+f,"",{},!1);if(404===l.status)return b[2].write("touch: cannot touch "+f+": No such file or directory"),1;if(403===l.status)return b[2].write("touch: cannot touch "+f+": Permission denied"),1;if(400<=l.status)return b[2].write("touch: cannot touch "+f+": An internal error occurred"),
1}return 0};b.commands.mkdir=function(b,c,d,e){for(var f=1;f<c;f++){var m=a.b(d[f],e.PWD,e.HOME),l=g.a("PUT","/files"+m,"",{"File-Type":"directory"},!1);if(404===l.status)return b[2].write("mkdir: cannot create directory "+m+": No such file or directory"),1;if(403===l.status)return b[2].write("mkdir: cannot create directory "+m+": Permission denied"),1;if(400<=l.status)return b[2].write("mkdir: cannot create directory "+m+": An internal error occurred"),1}return 0};b.commands.cp=function(b,c,d,e){3!==
c&&b[2].write("cp: invalid number of parameters");c=a.b(d[1],e.PWD,e.HOME);d=a.b(d[2],e.PWD,e.HOME);e=g.a("PUT","/files"+d,c,{"Content-Type":"application/vnd.webbash.filepath"},!1);return 404===e.status?(b[2].write("cp: cannot create regular file "+d+": No such file or directory"),1):403===e.status?(b[2].write("cp: cannot create regular file "+d+": Permission denied"),1):400<=e.status&&"Invalid file data source"===e.responseJSON?(b[2].write("cp: cannot stat "+c+": No such file or directory"),1):0};
b.commands.mv=function(b,c,d,e){3!==c&&b[2].write("mv: invalid number of parameters");c=a.b(d[1],e.PWD,e.HOME);d=a.b(d[2],e.PWD,e.HOME);e=g.a("PUT","/files"+d,c,{"Content-Type":"application/vnd.webbash.filepath"},!1);if(404===e.status)return b[2].write("mv: cannot create regular file "+d+": No such file or directory"),1;if(403===e.status)return b[2].write("mv: cannot create regular file "+d+": Permission denied"),1;if(400<=e.status&&"Invalid file data source"===e.responseJSON)return b[2].write("mv: cannot stat "+
c+": No such file or directory"),1;e=g.a("DELETE","/files"+c,"",{},!1);return 403===e.status?(b[2].write("mv: cannot remove "+c+": Permission denied"),1):0};b.commands.rm=t(0);b.commands.chmod=t(0);b.commands.chgrp=function(b,c,d,e){if(3>c)return b[2].write("chown: needs at least 2 parameters"),1;for(var f=2;f<c;f++){var m=a.b(d[f],e.PWD,e.HOME),l=g.a("PATCH","/files"+m,"",{"File-Group":d[1]},!1);if(404===l.status)b[2].write("chown: cannot access "+m+": No such file or directory");else if(403===l.status)b[2].write("chown: changing ownership of "+
m+": Permission denied");else if(400<=l.status&&"Invalid group"===l.responseJSON)return b[2].write("chown: invalid group: "+d[1]),1}return 0};b.commands.chown=function(b,c,d,e){if(3>c)return b[2].write("chown: needs at least 2 parameters"),1;for(var f=2;f<c;f++){var m=a.b(d[f],e.PWD,e.HOME),l=g.a("PATCH","/files"+m,"",{"File-Owner":d[1]},!1);if(404===l.status)b[2].write("chown: cannot access "+m+": No such file or directory");else if(403===l.status)b[2].write("chown: changing ownership of "+m+": Permission denied");
else if(400<=l.status&&"Invalid owner"===l.responseJSON)return b[2].write("chown: invalid user: "+d[1]),1}return 0}})(jQuery,v);
