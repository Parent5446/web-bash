function k(a){return function(){return a}}
(function(a){a.Event.prototype.s=function(){var b={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},f={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},a=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(a))return!1;"undefined"!==typeof f[a]&&(a=f[a]);f=String.fromCharCode(a);
this.shiftKey?"undefined"!==typeof b[f]&&(f=b[f]):f=f.toLowerCase();return f}})(jQuery);(function(a){a.n=function(b){b=b.substr(1).split("/");for(var f=[],a=0;a<b.length;a++)"."!==b[a]&&""!==b[a]&&(".."===b[a]?f.pop():f.push(b[a]));return"/"+f.join("/")}})(jQuery);window.Terminal=function(){this.f=null;this.prompt="root@ubuntu> ";this.c=[];this.d=0;this.o=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'))};this.j=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.o()};this.r=function(a){var b=$('<div class="system_output"></div>');b.text(a);$("body > ul > li:last-child").append(b);
this.o()};this.blink=function(){$("#cursor").toggleClass("blink")};this.l=function(){var a=$("#cursor"),b,f,e=a.prev(),c=a.next();if(0===e.length||!e.hasClass("userinput"))return!1;var d=e.text();if(0===d.length)return!1;b=d.substr(d.length-1);f=a.text();0===c.length&&"&nbsp;"!==f&&(c=$('<div class="userinput"></div>'),a.after(c));e.text(d.substring(0,d.length-1));a.text(b);return"&nbsp;"!==f?(c.prepend(f),!0):!1};this.h=function(){var a=$("#cursor"),b,f,e,c=a.prev(),d=a.next();if(0===d.length||!d.hasClass("userinput"))return!1;
e=d.text();if(0===e.length)return!1;b=e[0];f=a.text();if(0===d.length)return a.html("&nbsp;"),!1;d.text(e.substr(1));a.text(b);c.append(f);return!0};this.k=function(a){var b=$("#cursor").parent().children(".userinput").text();this.c[this.d]=b.substr(0,b.length-1);a=this.d+a;a<this.c.length&&0<=a&&(this.d=a,a=$("#cursor"),a.next().text(""),a.html("&nbsp;"),a.prev().text(this.c[this.d]))};this.u=function(a){var b;if(37===a.which)this.l();else if(39===a.which)this.h();else if(38===a.which)this.k(-1);
else if(40===a.which)this.k(1);else if(35===a.which)for(;this.h(););else if(36===a.which)for(;this.l(););else if(!a.ctrlKey||a.metaKey||a.shiftKey||67!==a.which)if(46===a.which)if(b=$("#cursor"),a=b.next(),0!==a.length&&a.hasClass("userinput")){var f=a.text();0!==f.length?(b.text(f.substr(0,1)),a.text(f.substr(1))):b.html("&nbsp;")}else b.html("&nbsp;");else 8===a.which?(a.preventDefault(),b=$("#cursor").prev(),0<b.length&&b.hasClass("userinput")&&b.text(b.text().slice(0,-1))):13===a.which?(b=$("#cursor").parent().children(".userinput").text(),
b=b.substr(0,b.length-1),0<b.length&&(this.c[this.c.length]=b,this.d=this.c.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.f.execute($.trim(b),this).progress($.proxy(this.r,this)).always($.proxy(this.j,this))):222===a.which&&a.shiftKey?(a.preventDefault(),b=$("#cursor").prev(),b.append('"'),this.h()):222===a.which?(a.preventDefault(),b=$("#cursor").prev(),b.append("'"),this.h()):(b=$("#cursor").prev(),(a=a.s())&&b.append(a));else a.preventDefault(),
$("#cursor").next().append("^C"),this.j();$(window).scrollTop($(document).height())};this.bind=function(a){this.f=a;$.proxy(this.f.p,this.f)(this);this.j()};$(window.document).keydown($.proxy(this.u,this));window.setInterval(this.blink,500)};function m(a){this.a={"?":"0"};this.w=/[\w\?\-\!]+/i;this.b=a;this.p=function(b){var a=(new p).i("GET","/users/"+this.b,{},!1).responseJSON.homedir;this.a.HOME=a;this.a.PWD=a;b.prompt=this.b+"@ubuntu "+a+" $ "};this.execute=function(b,a){var e=$.Deferred(),c=this.v(this.splitText(b));setTimeout($.proxy(function(){this.g(c,a,e)},this),0);return e.promise()};this.g=function(b,a,e){var c=b[0];this.a.A=b[b.length-1];if("eval"===b[0])b.shift(),0<b.length?this.g(b,output):this.a["?"]="0";else if("help"===
b[0])e.notify(["Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. "]),e.notify(["To see a full list of commands, type 'commands' "]),this.a["?"]="0";else if("echo"===b[0])b.shift(),e.notify([b.join(" ")]),this.a["?"]="0";else if("export"===b[0]){for(c=1;c<b.length;++c){var d=b[c].split("=",2);this.a[d[0]]=d[1]}this.a["?"]="0"}else if("unset"===b[0]){for(c=1;c<b.length;++c)this.a[b[c]]="";this.a["?"]="0"}else"cd"===b[0]?(this.a.PWD=1>=
b.length?this.a.HOME:"/"===b[1][0]?$.n(b[1]):$.n(this.a.PWD+"/"+b[1]),this.a["?"]="0"):"undefined"!==typeof m.commands[b[0]]?(d=[new q,new q,new q],d[1].flush=function(b){e.notify([b])},d[2].flush=function(b){e.notify([b])},this.a["?"]=m.commands[c](d,b.length,b,this.a).toString()):void 0!==b[0]&&""!==b[0]&&(e.notify(["error: unknown command "+b[0]]),this.a["?"]="127");a.prompt=this.b+"@ubuntu "+this.a.PWD+" $ ";e.resolve()};this.v=function(b){for(var a=1;a<b.length;++a)for(var e=b[a].indexOf("$");0<=
e;e=b[a].indexOf("$",e+1))if(0!==e&&"\\"===b[a][e-1])b[a]=b[a].substr(0,e-1)+b[a].substr(e);else{var c=this.w.exec(b[a].substr(e+1))[0];null!==c&&("undefined"===typeof this.a[c]&&(this.a[c]=""),b[a]=b[a].substr(0,e)+this.a[c]+b[a].substr(e+c.length+1))}return b};this.splitText=function(b){for(var a="",e=[],c=!1,d=!1,g=!1,h=0;h<b.length;h++)" "===b[h]&&(c||d)?a+=b[h]:" "!==b[h]||c||d?"\\"===b[h]?g||c?(a+="\\",g=!1):g=!0:"'"===b[h]?g?(a+="'",g=!1):d?a+="'":c=!c:'"'===b[h]?g?(a+='"',g=!1):c?a+='"':d=
!d:"$"===b[h]&&c?a+="\\$":(a+=b[h],g=!1):0<a.length&&(e.push(a),a="");a=$.trim(a);""!==a&&e.push(a);return e}}m.commands={};window.WebBash=m;window.WebBashLogin=function(){this.q=new p;this.b="";this.p=function(a){a.prompt="Username: "};this.execute=function(a,b){var f=$.Deferred();setTimeout($.proxy(function(){this.g(a,b,f)},this),0);return f.promise()};this.g=function(a,b,f){""===this.b?(this.b=a,""!==a&&(b.prompt="Password: "),f.resolve()):this.q.t(this.b,a).done($.proxy(function(){b.bind(new m(this.b))},this)).fail(function(a){f.notify(a.responseText);this.b=null;b.prompt="Username: ";f.resolve()})}};function q(){this.e=0;this.buffer="";this.write=function(a){this.buffer+=a;this.flush(this.buffer)};this.C=function(a){if(this.e>=this.buffer.length)return!1;if(void 0===a)return this.e=this.buffer.length,this.B;var b=this.buffer.substr(this.e,a);this.e+=a;return b};this.flush=function(){}};function p(){this.m=this.b="";this.t=function(a,b){this.b=a;this.m=b;return this.i("GET","/login").then($.proxy(function(a){return this.i("POST","/login",{username:this.b,password:this.m,token:a.token})},this))};this.i=function(a,b,f,e){return $.ajax({async:void 0===e?!0:e,data:f,dataType:"json",type:a,url:"api.php"+b})}};(function(a,b){b.commands["false"]=k(1);b.commands["true"]=k(0);b.commands.pwd=function(a,b,c,d){a[1].write(d.PWD);return 0};b.commands.commands=function(a){var e=[],c;for(c in b.commands)b.commands.hasOwnProperty(c)&&e.push(c);a[1].write(e.join("<br/>"));return 0};b.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var c=new Date,d=Array(7);d[0]="Sun";d[1]="Mon";d[2]="Tue";d[3]="Wed";d[4]="Thu";d[5]="Fri";d[6]="Sat";var g=Array(12);g[0]="Jan";g[1]="Feb";g[2]="Mar";
g[3]="Apr";g[4]="May";g[5]="Jun";g[6]="Jul";g[7]="Aug";g[8]="Sep";g[9]="Oct";g[10]="Nov";g[11]="Dec";var h="UTC";4===c.getTimezoneOffset()/60&&(h="EDT");var d=d[c.getDay()].toString()+" "+g[c.getMonth()].toString()+" "+c.getDate().toString()+" ",l=c.getHours(),g=l.toString();10>l&&(g="0"+l.toString());var n=c.getMinutes(),l=n.toString();10>n&&(l="0"+n.toString());var n=c.getSeconds(),r=n.toString();10>n&&(r="0"+n.toString());d+=g+":"+l+":"+r+" "+h+" "+c.getFullYear().toString()+" ";a[1].write(d);
return 0}})(jQuery,m);(function(a,b){var f=new p;b.commands.ls=function(a,b,d,g){1===b&&(d[b]=g.HOME,b++);for(g=1;g<b;g++)for(var h=f.i("GET","/files"+d[1],{},!1),l=0;l<h.responseJSON.length;l++)a[1].write(h.responseJSON[l]+"\n");return 0};b.commands.ln=k(0);b.commands.touch=k(0);b.commands.mkdir=k(0);b.commands.cp=k(0);b.commands.mv=k(0);b.commands.rm=k(0);b.commands.chmod=k(0);b.commands.chgrp=k(0);b.commands.chown=k(0)})(jQuery,m);
