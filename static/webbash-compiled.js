(function(a){a.Event.prototype.getChar=function(){var a={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")",",":"<",".":">","/":"?",";":":","'":'"',"[":"{","]":"}","\\":"|","`":"~","-":"_","=":"+"},c={96:48,97:49,98:50,99:51,100:52,101:53,102:54,103:55,104:56,105:57,106:42,107:43,109:45,110:46,111:47,186:59,187:61,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39},e=this.which;if(0<=[16,37,38,39,40,20,17,18,91].indexOf(e))return!1;"undefined"!==typeof c[e]&&(e=c[e]);c=String.fromCharCode(e);
this.shiftKey?"undefined"!==typeof a[c]&&(c=a[c]):c=c.toLowerCase();return c}})(jQuery);function Terminal(){this.controller=null;this.prompt="root@ubuntu> ";this.cmdHistory=[];this.currHistoryPos=0;this.resetCursor=function(){$("#cursor").remove();$("body > ul > li:last-child").append($('<div id="cursor" class="userinput">&nbsp;</div>'));$("#cursor").before($('<div class="userinput"></div>'));$("#cursor").after($('<div class="userinput"></div>'))};this.displayPrompt=function(){$("body > ul").append("<li>"+this.prompt+"</li>");this.resetCursor()};this.executeCommand=function(a){a=$.trim(a);
$("body > ul > li:last-child").append($('<div class="system_output"></div>'));for(var b=$(".system_output").last(),c="",e=[],f=!1,d=!1,g=0;g<a.length;g++)" "===a[g]&&f?c+=a[g]:" "!==a[g]||f?"\\"===a[g]?d?c+="\\":d=!0:"'"===a[g]?d?c+="'":f=f?!1:!0:"$"===a[g]&&f?c+="\\$":(c+=a[g],d=!1):0<c.length&&(e.push(c),c="");c=$.trim(c);""!==c&&e.push(c);this.controller.executeCommand(e,b)};this.blink=function(){$("#cursor").toggleClass("blink")};this.moveCursorLeft=function(){var a=$("#cursor"),b,c,e=a.prev(),
f=a.next();if(0===e.length||!e.hasClass("userinput"))return!1;var d=e.text();if(0===d.length)return!1;b=d.substr(d.length-1);c=a.text();0===f.length&&"&nbsp;"!==c&&(f=$('<div class="userinput"></div>'),a.after(f));e.text(d.substring(0,d.length-1));a.text(b);return"&nbsp;"!==c?(f.prepend(c),!0):!1};this.moveCursorRight=function(){var a=$("#cursor"),b,c,e,f=a.prev(),d=a.next();if(0===d.length||!d.hasClass("userinput"))return!1;e=d.text();if(0===e.length)return!1;b=e[0];c=a.text();if(0===d.length)return a.html("&nbsp;"),
!1;d.text(e.substr(1));a.text(b);f.append(c);return!0};this.cycleHistory=function(a){var b=$("#cursor").parent().children(".userinput").text();this.cmdHistory[this.currHistoryPos]=b.substr(0,b.length-1);a=this.currHistoryPos+a;a<this.cmdHistory.length&&0<=a&&(this.currHistoryPos=a,a=$("#cursor"),a.next().text(""),a.html("&nbsp;"),a.prev().text(this.cmdHistory[this.currHistoryPos]))};this.processInput=function(a){var b;if(37===a.which)this.moveCursorLeft();else if(39===a.which)this.moveCursorRight();
else if(38===a.which)this.cycleHistory(-1);else if(40===a.which)this.cycleHistory(1);else if(35===a.which)for(;this.moveCursorRight(););else if(36===a.which)for(;this.moveCursorLeft(););else if(!a.ctrlKey||a.metaKey||a.shiftKey||67!==a.which)if(46===a.which)if(b=$("#cursor"),a=b.next(),0!==a.length&&a.hasClass("userinput")){var c=a.text();0!==c.length?(b.text(c.substr(0,1)),a.text(c.substr(1))):b.html("&nbsp;")}else b.html("&nbsp;");else 8===a.which?(a.preventDefault(),b=$("#cursor").prev(),0<b.length&&
b.hasClass("userinput")&&b.text(b.text().slice(0,-1))):13===a.which?(b=$("#cursor").parent().children(".userinput").text(),b=b.substr(0,b.length-1),0<b.length&&(this.cmdHistory[this.cmdHistory.length]=b,this.currHistoryPos=this.cmdHistory.length),$("#cursor").prev().append($("#cursor").text()),$("#cursor").next().after($(" <br> ")),this.executeCommand(b),this.displayPrompt()):222===a.which?(a.preventDefault(),b=$("#cursor").prev(),b.append("'"),this.moveCursorRight(1)):(b=$("#cursor").prev(),(a=a.getChar())&&
b.append(a));else a.preventDefault(),$("#cursor").next().append("^C"),this.displayPrompt();$(window).scrollTop($(document).height())};this.bind=function(a,b){this.controller=b;var c=$(a.document);c.keydown($.proxy(this.processInput,this));c.ready($.proxy(function(){this.displayPrompt();a.setInterval(this.blink,500)},this))}};function WebBash(){this.environment={"?":"0"};this.varPatt=/[\w\?\-\!]+/i;this.executeCommand=function(a,b){var c=a[0];a=this.replaceVariables(a);this.environment._=a[a.length-1];if("eval"===a[0])a.shift(),0<a.length?this.executeCommand(a,b):this.environment["?"]="0";else if("help"===a[0])b.append("Web-Bash implements a command line interface just like BASH on linux. Type a command like 'date' to test it out. "),b.append("To see a full list of commands, type 'commands' "),this.environment["?"]="0";
else if("echo"===a[0])a.shift(),b.append(a.join(" ")),this.environment["?"]="0";else if("export"===a[0]){for(c=1;c<a.length;++c){var e=a[c].split("=",2);this.environment[e[0]]=e[1]}this.environment["?"]="0"}else if("unset"===a[0]){for(c=1;c<a.length;++c)this.environment[a[c]]="";this.environment["?"]="0"}else"undefined"!==typeof WebBash.commands[a[0]]?(e=[new IoStream,new IoStream,new IoStream],e[1].flush=function(a){b.append(a)},e[2].flush=function(a){b.append(a)},this.environment["?"]=WebBash.commands[c](e,
a.length,a,this.environment).toString()):void 0!==a[0]&&""!==a[0]&&(b.append("error: unknown command "+a[0]),this.environment["?"]="127")};this.replaceVariables=function(a){for(var b=1;b<a.length;++b)for(var c=a[b].indexOf("$");0<=c;c=a[b].indexOf("$",c+1))if(0!==c&&"\\"===a[b][c-1])a[b]=a[b].substr(0,c-1)+a[b].substr(c);else{var e=this.varPatt.exec(a[b].substr(c+1))[0];null!==e&&("undefined"===typeof this.environment[e]&&(this.environment[e]=""),a[b]=a[b].substr(0,c)+this.environment[e]+a[b].substr(c+
e.length+1))}return a}}WebBash.commands={};function IoStream(){this.inptr=0;this.buffer="";this.write=function(a){this.buffer+=a;this.flush(this.buffer)};this.read=function(a){if(this.inptr>=this.buffer.length)return!1;if(void 0===a)return this.inptr=this.buffer.length,this.inbuffer;var b=this.buffer.substr(this.inptr,a);this.inptr+=a;return b};this.flush=function(a){}};function WebBashApi(){this.password=this.username="";this.initializeSalt=function(){this.salt=sjcl.random.randomWords(4);this.password=(new sjcl.misc.hmac(this.salt)).encrypt(this.password)};this.modifyHeaders=function(a,b){var c=sjcl.random.randomWords(4),e=sjcl.misc.cachedPbkdf2(this.password,{iter:5E3,salt:c}),e=new sjcl.misc.hmac(e),f=b.type.toUpper()+"\n",d;for(d in b.headers)b.headers.hasOwnProperty(d)&&(f+=d.toLower()+":"+b.headers[d].toLower()+"\n");f+="string"===typeof b.data?b.data:$.param(b.data);
d=e.encrypt(f);b.headers.Authorization="WebBash username={0} passwordsalt={0} requestsalt={1} signature={3}".format(this.username,scjl.codec.base64.fromBits(this.salt),scjl.codec.base64.fromBits(c),scjl.codec.base64.fromBits(d.key));"GET"===b.type&&(b.ifModified=!0);return!0};this.request=function(a,b,c){return $.ajax({accepts:"application/json",beforeSend:$.proxy(this.modifyHeaders,this),data:c,dataType:"json",type:a,url:b})};sjcl.startCollectors();sjcl.random.addEventListener("seeded",$.proxy(this.initializeSalts,
this))};(function(a,b){b.commands["false"]=function(){return 1};b.commands["true"]=function(){return 0};b.commands.commands=function(a,e,f,d){e=[];for(var g in b.commands)b.commands.hasOwnProperty(g)&&e.push(g);a[1].write(e.join("<br/>"));return 0};b.commands.date=function(a,b){if(1<b)return a[2].write("error: date takes no args"),1;var f=new Date,d=Array(7);d[0]="Sun";d[1]="Mon";d[2]="Tue";d[3]="Wed";d[4]="Thu";d[5]="Fri";d[6]="Sat";var g=Array(12);g[0]="Jan";g[1]="Feb";g[2]="Mar";g[3]="Apr";g[4]="May";
g[5]="Jun";g[6]="Jul";g[7]="Aug";g[8]="Sep";g[9]="Oct";g[10]="Nov";g[11]="Dec";var l="UTC";4===f.getTimezoneOffset()/60&&(l="EDT");var d=d[f.getDay()].toString()+" "+g[f.getMonth()].toString()+" "+f.getDate().toString()+" ",k=f.getHours(),g=k.toString();10>k&&(g="0"+k.toString());var h=f.getMinutes(),k=h.toString();10>h&&(k="0"+h.toString());var h=f.getSeconds(),m=h.toString();10>h&&(m="0"+h.toString());d+=g+":"+k+":"+m+" "+l+" "+f.getFullYear().toString()+" ";a[1].write(d);return 0}})(jQuery,WebBash);(function(a,b){b.commands.ls=function(a,b,f,d){return 0};b.commands.ln=function(a,b,f,d){return 0};b.commands.touch=function(a,b,f,d){return 0};b.commands.mkdir=function(a,b,f,d){return 0};b.commands.cp=function(a,b,f,d){return 0};b.commands.mv=function(a,b,f,d){return 0};b.commands.rm=function(a,b,f,d){return 0};b.commands.chmod=function(a,b,f,d){return 0};b.commands.chgrp=function(a,b,f,d){return 0};b.commands.chown=function(a,b,f,d){return 0}})(jQuery,WebBash);
